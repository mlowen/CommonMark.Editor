/*! bootstrap-commonmark-editor 0.4.0 Copyright (c) 2014, 2015 Mike Lowen */
!function(){var e=function(e,n){var t=n.Parser(),i=n.HtmlRenderer(),o=function(e){return i.render(t.parse(e))},r=function(n){var t=this,i={preview:"cm-editor-header-preview",edit:"cm-editor-header-edit",toggle:"cm-editor-header-toggle"};t.element=e('<div class="cm-editor-header"></div>'),t.on={preview:function(e){t.element.on(i.preview,e)},edit:function(e){t.element.on(i.edit,e)},toggle:function(e){t.element.on(i.toggle,e)}},t.trigger={preview:function(n){t.element.trigger(new e.Event(i.preview,n))},edit:function(n){t.element.trigger(new e.Event(i.edit,n))},toggle:function(n){t.element.trigger(new e.Event(i.toggle))}},t.toggle=function(){n.toggle&&(g.hasClass(l)?g.removeClass(l).addClass(a):g.removeClass(a).addClass(l)),r&&r.toggle(),o.toggle()};var o=e('<ul class="tabs"></ul>').append(e("<li></li>").append(e('<a href="#" class="active">Edit</a>').click(function(){return t.trigger.edit({element:this}),!1}))).append(e("<li></li>").append(e('<a href="#">Preview</a>').click(function(){return t.trigger.preview({element:this}),!1})));if(n.inline){var r=null;if(n.toggle){var l="glyphicon-pencil",a="glyphicon-remove",g=e('<span class="glyphicon"></span>').addClass(l),c=e('<a href="#" class="pull-right toggle"></a>').append(g);c.click(function(e){e.preventDefault(),t.trigger.toggle()}),t.element.append(c)}o.hide(),n.title&&(r=e('<strong class="title"></strong>').text(n.title),t.element.append(r))}n.header||t.element.addClass("transparent"),t.element.append(o);var d=function(n){t.element.find("li a.active").removeClass("active"),e(n.element).addClass("active")};t.on.edit(d),t.on.preview(d)},l=function(n){var t=this,i=null,r={change:"cm-editor-content-change"},l=e('<textarea class="form-control"></textarea>'),a=e('<div class="preview"></div>');n.name&&l.attr("name",n.name),t.states={edit:1,preview:2},t.element=e('<div class="cm-editor-content"></div>').append(l).append(a),t.state=function(e){return"undefined"==typeof e?i:void(e!=i&&(i=e,i==t.states.edit?(l.show(),a.hide()):(l.hide(),a.show())))},t.text=function(e){return"undefined"==typeof e?l.val():void(l.val()!==e&&(l.val(e),l.change()))},t.show=function(){t.element.show()},t.hide=function(){t.element.hide()},t.toggle=function(){t.element.toggle()},t.on={change:function(e){t.element.on(r.change,e)}},t.trigger={change:function(n){t.element.trigger(new e.Event(r.change,n))}};var g=function(){var e=l.val();a.html(o(e)),t.trigger.change({text:e})};l.change(g).keydown(g).keyup(g),t.state(t.states.edit)},a=function(){var n=this,t="disabled",i=e('<button class="btn btn-default">Revert changes</button>'),o=e('<button class="btn btn-success pull-right">Save</button>'),r={save:"cm-editor-footer-save",revert:"cm-editor-footer-revert"};n.element=e('<div class="cm-editor-footer"></div>'),n.disable=function(){o.prop(t,!0),i.prop(t,!0)},n.enable=function(){o.prop(t,!1),i.prop(t,!1)},n.show=function(){n.element.show()},n.hide=function(){n.element.hide()},n.toggle=function(){n.element.toggle()},n.on={save:function(e){n.element.on(r.save,e)},revert:function(e){n.element.on(r.revert,e)}},n.trigger={save:function(){n.element.trigger(new e.Event(r.save))},revert:function(){n.element.trigger(new e.Event(r.revert))}},o.click(function(e){e.preventDefault(),n.trigger.save()}),i.click(function(e){e.preventDefault(),n.trigger.revert()}),n.element.append(i).append(o),n.disable()},g=function(n,t){var i=this,g="",c={change:"cm-editor-changed",inlineToggle:"cm-editor-inline-toggle"},d=function(){v.toggle(),f.toggle(),s.toggle(),t.save&&u.toggle(),i.trigger.inlineToggle()};i.element=e(n),i.text=function(e){return"undefined"==typeof e?g:void(g!==e&&(g=e,v.text(g),f&&f.html(o(g)),i.trigger.change({text:g})))},i.inline=function(e){if(!t.inline)return!1;var n=f.is(":visible");return"undefined"==typeof e?n:void(n!=e&&d())},i.on={change:function(e){i.element.on(c.change,e)},inlineToggle:function(e){i.element.on(c.inlineToggle,e)}},i.trigger={change:function(n){i.element.trigger(new e.Event(c.change,n))},inlineToggle:function(){i.element.trigger(new e.Event(c.inlineToggle))}};var s=new r(t),v=new l(t),u=t.save?new a:null,f=t.inline?e('<div class="inline-content"></div>'):null;s.on.edit(function(){v.state(v.states.edit)}),s.on.preview(function(){v.state(v.states.preview)}),v.on.change(function(e){t.save?e.text===g?u.disable():u.enable():i.text(e.text)}),t.save&&(u.on.save(function(){i.text(v.text())}),u.on.revert(function(){v.text(i.text())})),t.inline&&(v.hide(),t.save&&u.hide(),s.on.toggle(d));var m=e('<div class="cm-editor-body"></div>').append(v.element);u&&m.append(u.element),f&&m.append(f),i.element.addClass("commonmark-editor").append(s.element).append(m),i.text(t.text)};e.fn.commonMarkEditor=function(n){return n=e.extend({header:!0,inline:!1,name:null,save:!1,text:"",title:"",toggle:!0},n),this.map(function(e,t){return new g(t,n)})}};"function"==typeof define&&define.amd?define(["jquery","commonmark"],e):e(jQuery,commonmark)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb3RzdHJhcC1jb21tb25tYXJrLWVkaXRvci5qcyJdLCJuYW1lcyI6WyJpbml0IiwiJCIsImNvbW1vbm1hcmsiLCJyZWFkZXIiLCJQYXJzZXIiLCJ3cml0ZXIiLCJIdG1sUmVuZGVyZXIiLCJjb252ZXJ0Iiwic3RyIiwicmVuZGVyIiwicGFyc2UiLCJFZGl0b3JIZWFkZXIiLCJvcHRpb25zIiwic2VsZiIsInRoaXMiLCJldmVudHMiLCJwcmV2aWV3IiwiZWRpdCIsInRvZ2dsZSIsImVsZW1lbnQiLCJvbiIsImNhbGxiYWNrIiwidHJpZ2dlciIsImRhdGEiLCJFdmVudCIsImdseXBoIiwiaGFzQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiY2FuY2VsIiwidGl0bGUiLCJ0YWJzIiwiYXBwZW5kIiwiY2xpY2siLCJpbmxpbmUiLCJlIiwicHJldmVudERlZmF1bHQiLCJoaWRlIiwidGV4dCIsImhlYWRlciIsImZpbmQiLCJFZGl0b3JDb250ZW50Iiwic3RhdGUiLCJjaGFuZ2UiLCJ0ZXh0YXJlYSIsIm5hbWUiLCJhdHRyIiwic3RhdGVzIiwicyIsInNob3ciLCJ2YWwiLCJvbkNoYW5nZSIsImh0bWwiLCJrZXlkb3duIiwia2V5dXAiLCJFZGl0b3JGb290ZXIiLCJwcm9wZXJ0eSIsInJldmVydCIsInNhdmUiLCJkaXNhYmxlIiwicHJvcCIsImVuYWJsZSIsIkVkaXRvciIsImlubGluZVRvZ2dsZSIsInRvZ2dsZUlubGluZSIsImNvbnRlbnQiLCJpbmxpbmVDb250ZW50IiwiZm9vdGVyIiwidmFsdWUiLCJpc0lubGluZSIsImlzIiwiYm9keSIsImZuIiwiY29tbW9uTWFya0VkaXRvciIsImV4dGVuZCIsIm1hcCIsImluZGV4IiwiaXRlbSIsImRlZmluZSIsImFtZCIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQSxDQURBLFdBQ0MsR0FBSUEsR0FBTyxTQUFTQyxFQUFHQyxHQUN0QixHQUFJQyxHQUFTRCxFQUFXRSxTQUNwQkMsRUFBU0gs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Ty9DLEdBQUdxQyxPQUFPLFdBQWFRLEVBQVEzQixLQUFLekIsRUFBS3lCLFdBRzlDMUIsRUFBUXNCLFNBQ1YrQixFQUFRNUIsT0FFTHpCLEVBQVE4QyxNQUNWUyxFQUFPOUIsT0FFUkUsRUFBT25CLEdBQUdGLE9BQU84QyxHQUlsQixJQUFJTyxHQUFPdEUsRUFBRSxzQ0FBc0MrQixPQUFPaUMsRUFBUTlDLFFBRS9EZ0QsSUFDRkksRUFBS3ZDLE9BQU9tQyxFQUFPaEQsU0FFakIrQyxHQUNGSyxFQUFLdkMsT0FBT2tDLEdBRWJyRCxFQUFLTSxRQUFRUyxTQUFTLHFCQUNwQkksT0FBT08sRUFBT3BCLFNBQ2RhLE9BQU91QyxHQUVUMUQsRUFBS3lCLEtBQUsxQixFQUFRMEIsTUFHbkJyQyxHQUFFdUUsR0FBR0MsaUJBQW1CLFNBQVM3RCxHQVdoQyxNQVZBQSxHQUFVWCxFQUFFeUUsUUFDWG5DLFFBQVEsRUFDUkwsUUFBUSxFQUNSVyxLQUFNLEtBQ05hLE1BQU0sRUFDTnBCLEtBQU0sR0FDTlIsTUFBTyxHQUNQWixRQUFRLEdBQ05OLEdBRUlFLEtBQUs2RCxJQUFJLFNBQVNDLEVBQU9DLEdBQVEsTUFBTyxJQUFJZixHQUFPZSxFQUFNakUsTUFJN0MsbUJBQVhrRSxTQUF5QkEsT0FBT0MsSUFDekNELFFBQVMsU0FBVSxjQUFnQjlFLEdBRW5DQSxFQUFLZ0YsT0FBUTlFIiwiZmlsZSI6ImJvb3RzdHJhcC1jb21tb25tYXJrLWVkaXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuXHR2YXIgaW5pdCA9IGZ1bmN0aW9uKCQsIGNvbW1vbm1hcmspIHtcclxuXHRcdHZhciByZWFkZXIgPSBjb21tb25tYXJrLlBhcnNlcigpO1xyXG5cdFx0dmFyIHdyaXRlciA9IGNvbW1vbm1hcmsuSHRtbFJlbmRlcmVyKCk7XHJcblxyXG5cdFx0dmFyIGNvbnZlcnQgPSBmdW5jdGlvbiAoc3RyKSB7IHJldHVybiB3cml0ZXIucmVuZGVyKHJlYWRlci5wYXJzZShzdHIpKTsgfTtcclxuXHJcblx0XHR2YXIgRWRpdG9ySGVhZGVyID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0XHRcdHZhciBldmVudHMgPSB7IHByZXZpZXc6ICdjbS1lZGl0b3ItaGVhZGVyLXByZXZpZXcnLCBlZGl0OiAnY20tZWRpdG9yLWhlYWRlci1lZGl0JywgdG9nZ2xlOiAnY20tZWRpdG9yLWhlYWRlci10b2dnbGUnIH07XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuZWxlbWVudCA9ICQoJzxkaXYgY2xhc3M9XCJjbS1lZGl0b3ItaGVhZGVyXCI+PC9kaXY+Jyk7XHJcblxyXG5cdFx0XHQvLyBFdmVudHNcclxuXHRcdFx0c2VsZi5vbiA9IHtcclxuXHRcdFx0XHRwcmV2aWV3OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLnByZXZpZXcsIGNhbGxiYWNrKTsgfSxcclxuXHRcdFx0XHRlZGl0OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmVkaXQsIGNhbGxiYWNrKTsgfSxcclxuXHRcdFx0XHR0b2dnbGU6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMudG9nZ2xlLCBjYWxsYmFjayk7IH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYudHJpZ2dlciA9IHtcclxuXHRcdFx0XHRwcmV2aWV3OiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5wcmV2aWV3LCBkYXRhKSk7IH0sXHJcblx0XHRcdFx0ZWRpdDogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuZWRpdCwgZGF0YSkpOyB9LFxyXG5cdFx0XHRcdHRvZ2dsZTogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMudG9nZ2xlKSk7IH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYudG9nZ2xlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0aWYob3B0aW9ucy50b2dnbGUpIHtcclxuXHRcdFx0XHRcdGlmKGdseXBoLmhhc0NsYXNzKGVkaXQpKSB7XHJcblx0XHRcdFx0XHRcdGdseXBoLnJlbW92ZUNsYXNzKGVkaXQpLmFkZENsYXNzKGNhbmNlbCk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRnbHlwaC5yZW1vdmVDbGFzcyhjYW5jZWwpLmFkZENsYXNzKGVkaXQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYodGl0bGUpIHRpdGxlLnRvZ2dsZSgpO1xyXG5cclxuXHRcdFx0XHR0YWJzLnRvZ2dsZSgpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0LyogQ29uc3RydWN0b3IgKi9cclxuXHJcblx0XHRcdHZhciB0YWJzID0gJCgnPHVsIGNsYXNzPVwidGFic1wiPjwvdWw+JylcclxuXHRcdFx0XHQuYXBwZW5kKFxyXG5cdFx0XHRcdFx0JCgnPGxpPjwvbGk+JykuYXBwZW5kKFxyXG5cdFx0XHRcdFx0XHQkKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwiYWN0aXZlXCI+RWRpdDwvYT4nKS5jbGljayhmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIuZWRpdCh7IGVsZW1lbnQ6IHRoaXMgfSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdClcclxuXHRcdFx0XHQpXHJcblx0XHRcdFx0LmFwcGVuZChcclxuXHRcdFx0XHRcdCQoJzxsaT48L2xpPicpLmFwcGVuZChcclxuXHRcdFx0XHRcdFx0JCgnPGEgaHJlZj1cIiNcIj5QcmV2aWV3PC9hPicpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlci5wcmV2aWV3KHsgZWxlbWVudDogdGhpcyB9KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0KVxyXG5cdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLmlubGluZSkge1xyXG5cdFx0XHRcdHZhciB0aXRsZSA9IG51bGw7XHJcblxyXG5cdFx0XHRcdGlmKG9wdGlvbnMudG9nZ2xlKSB7XHJcblx0XHRcdFx0XHR2YXIgZWRpdCA9ICdnbHlwaGljb24tcGVuY2lsJztcclxuXHRcdFx0XHRcdHZhciBjYW5jZWwgPSAnZ2x5cGhpY29uLXJlbW92ZSc7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGdseXBoID0gJCgnPHNwYW4gY2xhc3M9XCJnbHlwaGljb25cIj48L3NwYW4+JykuYWRkQ2xhc3MoZWRpdCk7XHJcblx0XHRcdFx0XHR2YXIgdG9nZ2xlID0gJCgnPGEgaHJlZj1cIiNcIiBjbGFzcz1cInB1bGwtcmlnaHQgdG9nZ2xlXCI+PC9hPicpLmFwcGVuZChnbHlwaCk7XHJcblxyXG5cdFx0XHRcdFx0dG9nZ2xlLmNsaWNrKGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIudG9nZ2xlKCk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kKHRvZ2dsZSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0YWJzLmhpZGUoKTtcclxuXHJcblx0XHRcdFx0aWYob3B0aW9ucy50aXRsZSkge1xyXG5cdFx0XHRcdFx0dGl0bGUgPSAkKCc8c3Ryb25nIGNsYXNzPVwidGl0bGVcIj48L3N0cm9uZz4nKS50ZXh0KG9wdGlvbnMudGl0bGUpO1xyXG5cdFx0XHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZCh0aXRsZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZighb3B0aW9ucy5oZWFkZXIpXHJcblx0XHRcdFx0c2VsZi5lbGVtZW50LmFkZENsYXNzKCd0cmFuc3BhcmVudCcpO1xyXG5cclxuXHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZCh0YWJzKTtcclxuXHJcblx0XHRcdC8vIFRpZSB1cCBpbnRlcm5hbCBldmVudHNcclxuXHRcdFx0dmFyIGNsaWNrID0gZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0XHRcdHNlbGYuZWxlbWVudC5maW5kKCdsaSBhLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0XHQkKGRhdGEuZWxlbWVudCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi5vbi5lZGl0KGNsaWNrKTtcclxuXHRcdFx0c2VsZi5vbi5wcmV2aWV3KGNsaWNrKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgRWRpdG9yQ29udGVudCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0XHR2YXIgc3RhdGUgPSBudWxsO1xyXG5cdFx0XHR2YXIgZXZlbnRzID0geyBjaGFuZ2U6ICdjbS1lZGl0b3ItY29udGVudC1jaGFuZ2UnIH07XHJcblxyXG5cdFx0XHR2YXIgdGV4dGFyZWEgPSAkKCc8dGV4dGFyZWEgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIj48L3RleHRhcmVhPicpO1xyXG5cdFx0XHR2YXIgcHJldmlldyA9ICQoJzxkaXYgY2xhc3M9XCJwcmV2aWV3XCI+PC9kaXY+Jyk7XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLm5hbWUpXHJcblx0XHRcdFx0dGV4dGFyZWEuYXR0cignbmFtZScsIG9wdGlvbnMubmFtZSk7XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuc3RhdGVzID0geyBlZGl0OiAxLCBwcmV2aWV3OiAyIH1cclxuXHRcdFx0c2VsZi5lbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1jb250ZW50XCI+PC9kaXY+JylcclxuXHRcdFx0XHQuYXBwZW5kKHRleHRhcmVhKVxyXG5cdFx0XHRcdC5hcHBlbmQocHJldmlldyk7XHJcblxyXG5cdFx0XHQvLyBNZXRob2RzXHJcblx0XHRcdHNlbGYuc3RhdGUgPSBmdW5jdGlvbihzKSB7XHJcblx0XHRcdFx0aWYodHlwZW9mIHMgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gc3RhdGU7XHJcblx0XHRcdFx0aWYocyA9PSBzdGF0ZSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHRzdGF0ZSA9IHM7XHJcblxyXG5cdFx0XHRcdGlmKHN0YXRlID09IHNlbGYuc3RhdGVzLmVkaXQpIHtcclxuXHRcdFx0XHRcdHRleHRhcmVhLnNob3coKTtcclxuXHRcdFx0XHRcdHByZXZpZXcuaGlkZSgpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0ZXh0YXJlYS5oaWRlKCk7XHJcblx0XHRcdFx0XHRwcmV2aWV3LnNob3coKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRzZWxmLnRleHQgPSBmdW5jdGlvbih0ZXh0KSB7XHJcblx0XHRcdFx0aWYodHlwZW9mIHRleHQgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gdGV4dGFyZWEudmFsKCk7XHJcblxyXG5cdFx0XHRcdC8vIExldHMgbm90IGNhdXNlIHVubmVjZXNzYXJ5IHJlc2V0dGluZyBvZiB0ZXh0IGFuZCBmaXJlIHVubmVlZGVkIGV2ZW50cy5cclxuXHRcdFx0XHRpZih0ZXh0YXJlYS52YWwoKSA9PT0gdGV4dClcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdFx0dGV4dGFyZWEudmFsKHRleHQpO1xyXG5cdFx0XHRcdHRleHRhcmVhLmNoYW5nZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzZWxmLnNob3cgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnNob3coKTsgfTtcclxuXHRcdFx0c2VsZi5oaWRlID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC5oaWRlKCk7IH07XHJcblx0XHRcdHNlbGYudG9nZ2xlID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50b2dnbGUoKTsgfTtcclxuXHJcblx0XHRcdC8vIEV2ZW50c1xyXG5cdFx0XHRzZWxmLm9uID0geyBjaGFuZ2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMuY2hhbmdlLCBjYWxsYmFjayk7IH0gfTtcclxuXHRcdFx0c2VsZi50cmlnZ2VyID0geyBjaGFuZ2U6IGZ1bmN0aW9uKGRhdGEpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLmNoYW5nZSwgZGF0YSkpOyB9IH07XHJcblxyXG5cdFx0XHQvLyBDb25zdHJ1Y3RcclxuXHJcblx0XHRcdHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHZhciB0ZXh0ID0gdGV4dGFyZWEudmFsKCk7XHJcblxyXG5cdFx0XHRcdHByZXZpZXcuaHRtbChjb252ZXJ0KHRleHQpKTtcclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuY2hhbmdlKHsgdGV4dDogdGV4dCB9KTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHRleHRhcmVhLmNoYW5nZShvbkNoYW5nZSkua2V5ZG93bihvbkNoYW5nZSkua2V5dXAob25DaGFuZ2UpO1xyXG5cclxuXHRcdFx0c2VsZi5zdGF0ZShzZWxmLnN0YXRlcy5lZGl0KTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgRWRpdG9yRm9vdGVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdFx0dmFyIHByb3BlcnR5ID0gJ2Rpc2FibGVkJztcclxuXHRcdFx0dmFyIHJldmVydCA9ICQoJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLWRlZmF1bHRcIj5SZXZlcnQgY2hhbmdlczwvYnV0dG9uPicpO1xyXG5cdFx0XHR2YXIgc2F2ZSA9ICQoJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXN1Y2Nlc3MgcHVsbC1yaWdodFwiPlNhdmU8L2J1dHRvbj4nKTtcclxuXHRcdFx0dmFyIGV2ZW50cyA9IHsgc2F2ZTogJ2NtLWVkaXRvci1mb290ZXItc2F2ZScsIHJldmVydDogJ2NtLWVkaXRvci1mb290ZXItcmV2ZXJ0JyB9O1xyXG5cclxuXHRcdFx0LyogUHVibGljIEFQSSAqL1xyXG5cdFx0XHRzZWxmLmVsZW1lbnQgPSAkKCc8ZGl2IGNsYXNzPVwiY20tZWRpdG9yLWZvb3RlclwiPjwvZGl2PicpO1xyXG5cclxuXHRcdFx0Ly8gTWV0aG9kc1xyXG5cdFx0XHRzZWxmLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRzYXZlLnByb3AocHJvcGVydHksIHRydWUpO1xyXG5cdFx0XHRcdHJldmVydC5wcm9wKHByb3BlcnR5LCB0cnVlKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYuZW5hYmxlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0c2F2ZS5wcm9wKHByb3BlcnR5LCBmYWxzZSk7XHJcblx0XHRcdFx0cmV2ZXJ0LnByb3AocHJvcGVydHksIGZhbHNlKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYuc2hvdyA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQuc2hvdygpOyB9O1xyXG5cdFx0XHRzZWxmLmhpZGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LmhpZGUoKTsgfTtcclxuXHRcdFx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRvZ2dsZSgpOyB9O1xyXG5cclxuXHRcdFx0Ly8gRXZlbnRzXHJcblx0XHRcdHNlbGYub24gPSB7XHJcblx0XHRcdFx0c2F2ZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy5zYXZlLCBjYWxsYmFjayk7IH0sXHJcblx0XHRcdFx0cmV2ZXJ0OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLnJldmVydCwgY2FsbGJhY2spOyB9LFxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0XHRcdHNhdmU6IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuc2F2ZSkpOyB9LFxyXG5cdFx0XHRcdHJldmVydDogZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5yZXZlcnQpKTsgfSxcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8qIENvbnN0cnVjdCAqL1xyXG5cdFx0XHRzYXZlLmNsaWNrKGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0c2VsZi50cmlnZ2VyLnNhdmUoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXZlcnQuY2xpY2soZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIucmV2ZXJ0KCk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZChyZXZlcnQpLmFwcGVuZChzYXZlKTtcclxuXHRcdFx0c2VsZi5kaXNhYmxlKCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHZhciBFZGl0b3IgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XHJcblx0XHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdFx0dmFyIHRleHQgPSAnJztcclxuXHJcblx0XHRcdHZhciBldmVudHMgPSB7IGNoYW5nZTogJ2NtLWVkaXRvci1jaGFuZ2VkJywgaW5saW5lVG9nZ2xlOiAnY20tZWRpdG9yLWlubGluZS10b2dnbGUnIH07XHJcblxyXG5cdFx0XHQvKiBVdGlsaXR5IGZ1bmN0aW9ucyAqL1xyXG5cdFx0XHR2YXIgdG9nZ2xlSW5saW5lID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0Y29udGVudC50b2dnbGUoKTtcclxuXHRcdFx0XHRpbmxpbmVDb250ZW50LnRvZ2dsZSgpO1xyXG5cdFx0XHRcdGhlYWRlci50b2dnbGUoKTtcclxuXHJcblx0XHRcdFx0aWYob3B0aW9ucy5zYXZlKVxyXG5cdFx0XHRcdFx0Zm9vdGVyLnRvZ2dsZSgpO1xyXG5cclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuaW5saW5lVG9nZ2xlKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcblxyXG5cdFx0XHQvLyBNZXRob2RzXHJcblx0XHRcdHNlbGYudGV4dCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdFx0aWYodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJylcclxuXHRcdFx0XHRcdHJldHVybiB0ZXh0O1xyXG5cclxuXHRcdFx0XHRpZih0ZXh0ID09PSB2YWx1ZSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHR0ZXh0ID0gdmFsdWU7XHJcblx0XHRcdFx0Y29udGVudC50ZXh0KHRleHQpO1xyXG5cclxuXHRcdFx0XHRpZihpbmxpbmVDb250ZW50KVxyXG5cdFx0XHRcdFx0aW5saW5lQ29udGVudC5odG1sKGNvbnZlcnQodGV4dCkpO1xyXG5cclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuY2hhbmdlKHsgdGV4dDogdGV4dCB9KTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYuaW5saW5lID0gZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0XHRpZighb3B0aW9ucy5pbmxpbmUpXHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblxyXG5cdFx0XHRcdHZhciBpc0lubGluZSA9IGlubGluZUNvbnRlbnQuaXMoJzp2aXNpYmxlJyk7XHJcblxyXG5cdFx0XHRcdGlmKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpXHJcblx0XHRcdFx0XHRyZXR1cm4gaXNJbmxpbmU7XHJcblxyXG5cdFx0XHRcdGlmKGlzSW5saW5lICE9IHZhbHVlKVxyXG5cdFx0XHRcdFx0dG9nZ2xlSW5saW5lKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyBFdmVudHNcclxuXHJcblx0XHRcdHNlbGYub24gPSB7XHJcblx0XHRcdFx0Y2hhbmdlOiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmNoYW5nZSwgY2FsbGJhY2spOyB9LFxyXG5cdFx0XHRcdGlubGluZVRvZ2dsZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy5pbmxpbmVUb2dnbGUsIGNhbGxiYWNrKTsgfVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0XHRcdGNoYW5nZTogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuY2hhbmdlLCBkYXRhKSk7IH0sXHJcblx0XHRcdFx0aW5saW5lVG9nZ2xlOiBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLmlubGluZVRvZ2dsZSkpOyB9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvKiBDb25zdHJ1Y3RvciAqL1xyXG5cdFx0XHR2YXIgaGVhZGVyID0gbmV3IEVkaXRvckhlYWRlcihvcHRpb25zKTtcclxuXHRcdFx0dmFyIGNvbnRlbnQgPSBuZXcgRWRpdG9yQ29udGVudChvcHRpb25zKTtcclxuXHRcdFx0dmFyIGZvb3RlciA9IG9wdGlvbnMuc2F2ZSA/IG5ldyBFZGl0b3JGb290ZXIoKSA6IG51bGw7XHJcblx0XHRcdHZhciBpbmxpbmVDb250ZW50ID0gb3B0aW9ucy5pbmxpbmUgPyAkKCc8ZGl2IGNsYXNzPVwiaW5saW5lLWNvbnRlbnRcIj48L2Rpdj4nKSA6IG51bGw7XHJcblxyXG5cdFx0XHQvLyBTdWJzY3JpYmUgdG8gZXZlbnRzXHJcblxyXG5cdFx0XHRoZWFkZXIub24uZWRpdChmdW5jdGlvbigpIHsgY29udGVudC5zdGF0ZShjb250ZW50LnN0YXRlcy5lZGl0KTsgfSk7XHJcblx0XHRcdGhlYWRlci5vbi5wcmV2aWV3KGZ1bmN0aW9uKCkgeyBjb250ZW50LnN0YXRlKGNvbnRlbnQuc3RhdGVzLnByZXZpZXcpOyB9KTtcclxuXHJcblx0XHRcdGNvbnRlbnQub24uY2hhbmdlKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0XHRpZihvcHRpb25zLnNhdmUpIHtcclxuXHRcdFx0XHRcdGlmKGRhdGEudGV4dCA9PT0gdGV4dCkgZm9vdGVyLmRpc2FibGUoKTtcclxuXHRcdFx0XHRcdGVsc2UgZm9vdGVyLmVuYWJsZSgpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRzZWxmLnRleHQoZGF0YS50ZXh0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0aWYob3B0aW9ucy5zYXZlKSB7XHJcblx0XHRcdFx0Zm9vdGVyLm9uLnNhdmUoZnVuY3Rpb24oKSB7IHNlbGYudGV4dChjb250ZW50LnRleHQoKSk7IH0pO1xyXG5cdFx0XHRcdGZvb3Rlci5vbi5yZXZlcnQoZnVuY3Rpb24oKSB7IGNvbnRlbnQudGV4dChzZWxmLnRleHQoKSk7IH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLmlubGluZSkge1xyXG5cdFx0XHRcdGNvbnRlbnQuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRpZihvcHRpb25zLnNhdmUpXHJcblx0XHRcdFx0XHRmb290ZXIuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRoZWFkZXIub24udG9nZ2xlKHRvZ2dsZUlubGluZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEFkZCBhbGwgdGhlIGVsZW1lbnRzXHJcblx0XHRcdHZhciBib2R5ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1ib2R5XCI+PC9kaXY+JykuYXBwZW5kKGNvbnRlbnQuZWxlbWVudCk7XHJcblxyXG5cdFx0XHRpZihmb290ZXIpXHJcblx0XHRcdFx0Ym9keS5hcHBlbmQoZm9vdGVyLmVsZW1lbnQpO1xyXG5cclxuXHRcdFx0aWYoaW5saW5lQ29udGVudClcclxuXHRcdFx0XHRib2R5LmFwcGVuZChpbmxpbmVDb250ZW50KTtcclxuXHJcblx0XHRcdHNlbGYuZWxlbWVudC5hZGRDbGFzcygnY29tbW9ubWFyay1lZGl0b3InKVxyXG5cdFx0XHRcdC5hcHBlbmQoaGVhZGVyLmVsZW1lbnQpXHJcblx0XHRcdFx0LmFwcGVuZChib2R5KTtcclxuXHJcblx0XHRcdHNlbGYudGV4dChvcHRpb25zLnRleHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdCQuZm4uY29tbW9uTWFya0VkaXRvciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRcdFx0b3B0aW9ucyA9ICQuZXh0ZW5kKHtcclxuXHRcdFx0XHRoZWFkZXI6IHRydWUsXHJcblx0XHRcdFx0aW5saW5lOiBmYWxzZSxcclxuXHRcdFx0XHRuYW1lOiBudWxsLFxyXG5cdFx0XHRcdHNhdmU6IGZhbHNlLFxyXG5cdFx0XHRcdHRleHQ6ICcnLFxyXG5cdFx0XHRcdHRpdGxlOiAnJyxcclxuXHRcdFx0XHR0b2dnbGU6IHRydWVcclxuXHRcdFx0fSwgb3B0aW9ucyk7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oaW5kZXgsIGl0ZW0pIHsgcmV0dXJuIG5ldyBFZGl0b3IoaXRlbSwgb3B0aW9ucyk7IH0pO1xyXG5cdFx0fTtcclxuXHR9O1xyXG5cclxuXHRpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXHJcblx0XHRkZWZpbmUoWyAnanF1ZXJ5JywgJ2NvbW1vbm1hcmsnIF0sIGluaXQpO1xyXG5cdGVsc2VcclxuXHRcdGluaXQoalF1ZXJ5LCBjb21tb25tYXJrKVxyXG59KSgpO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
