!function(){var e=function(e,n){var t=n.Parser(),i=n.HtmlRenderer(),o=function(e){return i.render(t.parse(e))},r=function(n){var t=this,i={preview:"cm-editor-header-preview",edit:"cm-editor-header-edit",toggle:"cm-editor-header-toggle"};t.element=e('<div class="cm-editor-header"></div>'),t.on={preview:function(e){t.element.on(i.preview,e)},edit:function(e){t.element.on(i.edit,e)},toggle:function(e){t.element.on(i.toggle,e)}},t.trigger={preview:function(n){t.element.trigger(new e.Event(i.preview,n))},edit:function(n){t.element.trigger(new e.Event(i.edit,n))},toggle:function(n){t.element.trigger(new e.Event(i.toggle))}},t.toggle=function(){n.toggle&&(g.hasClass(l)?g.removeClass(l).addClass(a):g.removeClass(a).addClass(l)),r&&r.toggle(),o.toggle()};var o=e('<ul class="tabs"></ul>').append(e("<li></li>").append(e('<a href="#" class="active">Edit</a>').click(function(){return t.trigger.edit({element:this}),!1}))).append(e("<li></li>").append(e('<a href="#">Preview</a>').click(function(){return t.trigger.preview({element:this}),!1})));if(n.inline){var r=null;if(n.toggle){var l="glyphicon-pencil",a="glyphicon-remove",g=e('<span class="glyphicon"></span>').addClass(l),c=e('<a href="#" class="pull-right toggle"></a>').append(g);c.click(function(e){e.preventDefault(),t.trigger.toggle()}),t.element.append(c)}o.hide(),n.title&&(r=e('<strong class="title"></strong>').text(n.title),t.element.append(r))}n.header||t.element.addClass("transparent"),t.element.append(o);var d=function(n){t.element.find("li a.active").removeClass("active"),e(n.element).addClass("active")};t.on.edit(d),t.on.preview(d)},l=function(n){var t=this,i=null,r={change:"cm-editor-content-change"},l=e('<textarea class="form-control"></textarea>'),a=e('<div class="preview"></div>');n.name&&l.attr("name",n.name),t.states={edit:1,preview:2},t.element=e('<div class="cm-editor-content"></div>').append(l).append(a),t.state=function(e){return"undefined"==typeof e?i:void(e!=i&&(i=e,i==t.states.edit?(l.show(),a.hide()):(l.hide(),a.show())))},t.text=function(e){return"undefined"==typeof e?l.val():void(l.val()!==e&&(l.val(e),l.change()))},t.show=function(){t.element.show()},t.hide=function(){t.element.hide()},t.toggle=function(){t.element.toggle()},t.on={change:function(e){t.element.on(r.change,e)}},t.trigger={change:function(n){t.element.trigger(new e.Event(r.change,n))}};var g=function(){var e=l.val();a.html(o(e)),t.trigger.change({text:e})};l.change(g).keydown(g).keyup(g),t.state(t.states.edit)},a=function(){var n=this,t="disabled",i=e('<button class="btn btn-default">Revert changes</button>'),o=e('<button class="btn btn-success pull-right">Save</button>'),r={save:"cm-editor-footer-save",revert:"cm-editor-footer-revert"};n.element=e('<div class="cm-editor-footer"></div>'),n.disable=function(){o.prop(t,!0),i.prop(t,!0)},n.enable=function(){o.prop(t,!1),i.prop(t,!1)},n.show=function(){n.element.show()},n.hide=function(){n.element.hide()},n.toggle=function(){n.element.toggle()},n.on={save:function(e){n.element.on(r.save,e)},revert:function(e){n.element.on(r.revert,e)}},n.trigger={save:function(){n.element.trigger(new e.Event(r.save))},revert:function(){n.element.trigger(new e.Event(r.revert))}},o.click(function(e){e.preventDefault(),n.trigger.save()}),i.click(function(e){e.preventDefault(),n.trigger.revert()}),n.element.append(i).append(o),n.disable()},g=function(n,t){var i=this,g="",c={change:"cm-editor-changed",inlineToggle:"cm-editor-inline-toggle"},d=function(){v.toggle(),f.toggle(),s.toggle(),t.save&&u.toggle(),i.trigger.inlineToggle()};i.element=e(n),i.text=function(e){return"undefined"==typeof e?g:void(g!==e&&(g=e,v.text(g),f&&f.html(o(g)),i.trigger.change({text:g})))},i.inline=function(e){if(!t.inline)return!1;var n=f.is(":visible");return"undefined"==typeof e?n:void(n!=e&&d())},i.on={change:function(e){i.element.on(c.change,e)},inlineToggle:function(e){i.element.on(c.inlineToggle,e)}},i.trigger={change:function(n){i.element.trigger(new e.Event(c.change,n))},inlineToggle:function(){i.element.trigger(new e.Event(c.inlineToggle))}};var s=new r(t),v=new l(t),u=t.save?new a:null,f=t.inline?e('<div class="inline-content"></div>'):null;s.on.edit(function(){v.state(v.states.edit)}),s.on.preview(function(){v.state(v.states.preview)}),v.on.change(function(e){t.save?e.text===g?u.disable():u.enable():i.text(e.text)}),t.save&&(u.on.save(function(){i.text(v.text())}),u.on.revert(function(){v.text(i.text())})),t.inline&&(v.hide(),t.save&&u.hide(),s.on.toggle(d));var m=e('<div class="cm-editor-body"></div>').append(v.element);u&&m.append(u.element),f&&m.append(f),i.element.addClass("commonmark-editor").append(s.element).append(m),i.text(t.text)};e.fn.commonMarkEditor=function(n){return n=e.extend({header:!0,inline:!1,name:null,save:!1,text:"",title:"",toggle:!0},n),this.map(function(e,t){return new g(t,n)})}};"function"==typeof define&&define.amd?define(["jquery","commonmark"],e):e(jQuery,commonmark)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb3RzdHJhcC1jb21tb25tYXJrLWVkaXRvci5qcyJdLCJuYW1lcyI6WyJpbml0IiwiJCIsImNvbW1vbm1hcmsiLCJyZWFkZXIiLCJQYXJzZXIiLCJ3cml0ZXIiLCJIdG1sUmVuZGVyZXIiLCJjb252ZXJ0Iiwic3RyIiwicmVuZGVyIiwicGFyc2UiLCJFZGl0b3JIZWFkZXIiLCJvcHRpb25zIiwic2VsZiIsInRoaXMiLCJldmVudHMiLCJwcmV2aWV3IiwiZWRpdCIsInRvZ2dsZSIsImVsZW1lbnQiLCJvbiIsImNhbGxiYWNrIiwidHJpZ2dlciIsImRhdGEiLCJFdmVudCIsImdseXBoIiwiaGFzQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiY2FuY2VsIiwidGl0bGUiLCJ0YWJzIiwiYXBwZW5kIiwiY2xpY2siLCJpbmxpbmUiLCJlIiwicHJldmVudERlZmF1bHQiLCJoaWRlIiwidGV4dCIsImhlYWRlciIsImZpbmQiLCJFZGl0b3JDb250ZW50Iiwic3RhdGUiLCJjaGFuZ2UiLCJ0ZXh0YXJlYSIsIm5hbWUiLCJhdHRyIiwic3RhdGVzIiwicyIsInNob3ciLCJ2YWwiLCJvbkNoYW5nZSIsImh0bWwiLCJrZXlkb3duIiwia2V5dXAiLCJFZGl0b3JGb290ZXIiLCJwcm9wZXJ0eSIsInJldmVydCIsInNhdmUiLCJkaXNhYmxlIiwicHJvcCIsImVuYWJsZSIsIkVkaXRvciIsImlubGluZVRvZ2dsZSIsInRvZ2dsZUlubGluZSIsImNvbnRlbnQiLCJpbmxpbmVDb250ZW50IiwiZm9vdGVyIiwidmFsdWUiLCJpc0lubGluZSIsImlzIiwiYm9keSIsImZuIiwiY29tbW9uTWFya0VkaXRvciIsImV4dGVuZCIsIm1hcCIsImluZGV4IiwiaXRlbSIsImRlZmluZSIsImFtZCIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQyxHQUFJQSxHQUFPLFNBQVNDLEVBQUdDLEdBQ3RCLEdBQUlDLEdBQVNELEVBQVdFLFNBQ3BCQyxFQUFTSCxFQUFXSSxlQUVw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LE9BQU8sV0FBYVEsRUFBUTNCLEtBQUt6QixFQUFLeUIsV0FHOUMxQixFQUFRc0IsU0FDVitCLEVBQVE1QixPQUVMekIsRUFBUThDLE1BQ1ZTLEVBQU85QixPQUVSRSxFQUFPbkIsR0FBR0YsT0FBTzhDLEdBSWxCLElBQUlPLEdBQU90RSxFQUFFLHNDQUFzQytCLE9BQU9pQyxFQUFROUMsUUFFL0RnRCxJQUNGSSxFQUFLdkMsT0FBT21DLEVBQU9oRCxTQUVqQitDLEdBQ0ZLLEVBQUt2QyxPQUFPa0MsR0FFYnJELEVBQUtNLFFBQVFTLFNBQVMscUJBQ3BCSSxPQUFPTyxFQUFPcEIsU0FDZGEsT0FBT3VDLEdBRVQxRCxFQUFLeUIsS0FBSzFCLEVBQVEwQixNQUduQnJDLEdBQUV1RSxHQUFHQyxpQkFBbUIsU0FBUzdELEdBV2hDLE1BVkFBLEdBQVVYLEVBQUV5RSxRQUNYbkMsUUFBUSxFQUNSTCxRQUFRLEVBQ1JXLEtBQU0sS0FDTmEsTUFBTSxFQUNOcEIsS0FBTSxHQUNOUixNQUFPLEdBQ1BaLFFBQVEsR0FDTk4sR0FFSUUsS0FBSzZELElBQUksU0FBU0MsRUFBT0MsR0FBUSxNQUFPLElBQUlmLEdBQU9lLEVBQU1qRSxNQUk3QyxtQkFBWGtFLFNBQXlCQSxPQUFPQyxJQUN6Q0QsUUFBUyxTQUFVLGNBQWdCOUUsR0FFbkNBLEVBQUtnRixPQUFROUUiLCJmaWxlIjoiYm9vdHN0cmFwLWNvbW1vbm1hcmstZWRpdG9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xyXG5cdHZhciBpbml0ID0gZnVuY3Rpb24oJCwgY29tbW9ubWFyaykge1xyXG5cdFx0dmFyIHJlYWRlciA9IGNvbW1vbm1hcmsuUGFyc2VyKCk7XHJcblx0XHR2YXIgd3JpdGVyID0gY29tbW9ubWFyay5IdG1sUmVuZGVyZXIoKTtcclxuXHJcblx0XHR2YXIgY29udmVydCA9IGZ1bmN0aW9uIChzdHIpIHsgcmV0dXJuIHdyaXRlci5yZW5kZXIocmVhZGVyLnBhcnNlKHN0cikpOyB9O1xyXG5cclxuXHRcdHZhciBFZGl0b3JIZWFkZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7XHJcblx0XHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdFx0dmFyIGV2ZW50cyA9IHsgcHJldmlldzogJ2NtLWVkaXRvci1oZWFkZXItcHJldmlldycsIGVkaXQ6ICdjbS1lZGl0b3ItaGVhZGVyLWVkaXQnLCB0b2dnbGU6ICdjbS1lZGl0b3ItaGVhZGVyLXRvZ2dsZScgfTtcclxuXHJcblx0XHRcdC8qIFB1YmxpYyBBUEkgKi9cclxuXHRcdFx0c2VsZi5lbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1oZWFkZXJcIj48L2Rpdj4nKTtcclxuXHJcblx0XHRcdC8vIEV2ZW50c1xyXG5cdFx0XHRzZWxmLm9uID0ge1xyXG5cdFx0XHRcdHByZXZpZXc6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMucHJldmlldywgY2FsbGJhY2spOyB9LFxyXG5cdFx0XHRcdGVkaXQ6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMuZWRpdCwgY2FsbGJhY2spOyB9LFxyXG5cdFx0XHRcdHRvZ2dsZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy50b2dnbGUsIGNhbGxiYWNrKTsgfVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0XHRcdHByZXZpZXc6IGZ1bmN0aW9uKGRhdGEpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLnByZXZpZXcsIGRhdGEpKTsgfSxcclxuXHRcdFx0XHRlZGl0OiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5lZGl0LCBkYXRhKSk7IH0sXHJcblx0XHRcdFx0dG9nZ2xlOiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy50b2dnbGUpKTsgfVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRpZihvcHRpb25zLnRvZ2dsZSkge1xyXG5cdFx0XHRcdFx0aWYoZ2x5cGguaGFzQ2xhc3MoZWRpdCkpIHtcclxuXHRcdFx0XHRcdFx0Z2x5cGgucmVtb3ZlQ2xhc3MoZWRpdCkuYWRkQ2xhc3MoY2FuY2VsKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdGdseXBoLnJlbW92ZUNsYXNzKGNhbmNlbCkuYWRkQ2xhc3MoZWRpdCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZih0aXRsZSkgdGl0bGUudG9nZ2xlKCk7XHJcblxyXG5cdFx0XHRcdHRhYnMudG9nZ2xlKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvKiBDb25zdHJ1Y3RvciAqL1xyXG5cclxuXHRcdFx0dmFyIHRhYnMgPSAkKCc8dWwgY2xhc3M9XCJ0YWJzXCI+PC91bD4nKVxyXG5cdFx0XHRcdC5hcHBlbmQoXHJcblx0XHRcdFx0XHQkKCc8bGk+PC9saT4nKS5hcHBlbmQoXHJcblx0XHRcdFx0XHRcdCQoJzxhIGhyZWY9XCIjXCIgY2xhc3M9XCJhY3RpdmVcIj5FZGl0PC9hPicpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlci5lZGl0KHsgZWxlbWVudDogdGhpcyB9KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0KVxyXG5cdFx0XHRcdClcclxuXHRcdFx0XHQuYXBwZW5kKFxyXG5cdFx0XHRcdFx0JCgnPGxpPjwvbGk+JykuYXBwZW5kKFxyXG5cdFx0XHRcdFx0XHQkKCc8YSBocmVmPVwiI1wiPlByZXZpZXc8L2E+JykuY2xpY2soZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdFx0c2VsZi50cmlnZ2VyLnByZXZpZXcoeyBlbGVtZW50OiB0aGlzIH0pO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHQpXHJcblx0XHRcdFx0KTtcclxuXHJcblx0XHRcdGlmKG9wdGlvbnMuaW5saW5lKSB7XHJcblx0XHRcdFx0dmFyIHRpdGxlID0gbnVsbDtcclxuXHJcblx0XHRcdFx0aWYob3B0aW9ucy50b2dnbGUpIHtcclxuXHRcdFx0XHRcdHZhciBlZGl0ID0gJ2dseXBoaWNvbi1wZW5jaWwnO1xyXG5cdFx0XHRcdFx0dmFyIGNhbmNlbCA9ICdnbHlwaGljb24tcmVtb3ZlJztcclxuXHJcblx0XHRcdFx0XHR2YXIgZ2x5cGggPSAkKCc8c3BhbiBjbGFzcz1cImdseXBoaWNvblwiPjwvc3Bhbj4nKS5hZGRDbGFzcyhlZGl0KTtcclxuXHRcdFx0XHRcdHZhciB0b2dnbGUgPSAkKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwicHVsbC1yaWdodCB0b2dnbGVcIj48L2E+JykuYXBwZW5kKGdseXBoKTtcclxuXHJcblx0XHRcdFx0XHR0b2dnbGUuY2xpY2soZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlci50b2dnbGUoKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHRcdHNlbGYuZWxlbWVudC5hcHBlbmQodG9nZ2xlKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRhYnMuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRpZihvcHRpb25zLnRpdGxlKSB7XHJcblx0XHRcdFx0XHR0aXRsZSA9ICQoJzxzdHJvbmcgY2xhc3M9XCJ0aXRsZVwiPjwvc3Ryb25nPicpLnRleHQob3B0aW9ucy50aXRsZSk7XHJcblx0XHRcdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kKHRpdGxlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmKCFvcHRpb25zLmhlYWRlcilcclxuXHRcdFx0XHRzZWxmLmVsZW1lbnQuYWRkQ2xhc3MoJ3RyYW5zcGFyZW50Jyk7XHJcblxyXG5cdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kKHRhYnMpO1xyXG5cclxuXHRcdFx0Ly8gVGllIHVwIGludGVybmFsIGV2ZW50c1xyXG5cdFx0XHR2YXIgY2xpY2sgPSBmdW5jdGlvbihkYXRhKSB7XHJcblx0XHRcdFx0c2VsZi5lbGVtZW50LmZpbmQoJ2xpIGEuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHRcdCQoZGF0YS5lbGVtZW50KS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRzZWxmLm9uLmVkaXQoY2xpY2spO1xyXG5cdFx0XHRzZWxmLm9uLnByZXZpZXcoY2xpY2spO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBFZGl0b3JDb250ZW50ID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0XHRcdHZhciBzdGF0ZSA9IG51bGw7XHJcblx0XHRcdHZhciBldmVudHMgPSB7IGNoYW5nZTogJ2NtLWVkaXRvci1jb250ZW50LWNoYW5nZScgfTtcclxuXHJcblx0XHRcdHZhciB0ZXh0YXJlYSA9ICQoJzx0ZXh0YXJlYSBjbGFzcz1cImZvcm0tY29udHJvbFwiPjwvdGV4dGFyZWE+Jyk7XHJcblx0XHRcdHZhciBwcmV2aWV3ID0gJCgnPGRpdiBjbGFzcz1cInByZXZpZXdcIj48L2Rpdj4nKTtcclxuXHJcblx0XHRcdGlmKG9wdGlvbnMubmFtZSlcclxuXHRcdFx0XHR0ZXh0YXJlYS5hdHRyKCduYW1lJywgb3B0aW9ucy5uYW1lKTtcclxuXHJcblx0XHRcdC8qIFB1YmxpYyBBUEkgKi9cclxuXHRcdFx0c2VsZi5zdGF0ZXMgPSB7IGVkaXQ6IDEsIHByZXZpZXc6IDIgfVxyXG5cdFx0XHRzZWxmLmVsZW1lbnQgPSAkKCc8ZGl2IGNsYXNzPVwiY20tZWRpdG9yLWNvbnRlbnRcIj48L2Rpdj4nKVxyXG5cdFx0XHRcdC5hcHBlbmQodGV4dGFyZWEpXHJcblx0XHRcdFx0LmFwcGVuZChwcmV2aWV3KTtcclxuXHJcblx0XHRcdC8vIE1ldGhvZHNcclxuXHRcdFx0c2VsZi5zdGF0ZSA9IGZ1bmN0aW9uKHMpIHtcclxuXHRcdFx0XHRpZih0eXBlb2YgcyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBzdGF0ZTtcclxuXHRcdFx0XHRpZihzID09IHN0YXRlKSByZXR1cm47XHJcblxyXG5cdFx0XHRcdHN0YXRlID0gcztcclxuXHJcblx0XHRcdFx0aWYoc3RhdGUgPT0gc2VsZi5zdGF0ZXMuZWRpdCkge1xyXG5cdFx0XHRcdFx0dGV4dGFyZWEuc2hvdygpO1xyXG5cdFx0XHRcdFx0cHJldmlldy5oaWRlKCk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHRleHRhcmVhLmhpZGUoKTtcclxuXHRcdFx0XHRcdHByZXZpZXcuc2hvdygpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYudGV4dCA9IGZ1bmN0aW9uKHRleHQpIHtcclxuXHRcdFx0XHRpZih0eXBlb2YgdGV4dCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB0ZXh0YXJlYS52YWwoKTtcclxuXHJcblx0XHRcdFx0Ly8gTGV0cyBub3QgY2F1c2UgdW5uZWNlc3NhcnkgcmVzZXR0aW5nIG9mIHRleHQgYW5kIGZpcmUgdW5uZWVkZWQgZXZlbnRzLlxyXG5cdFx0XHRcdGlmKHRleHRhcmVhLnZhbCgpID09PSB0ZXh0KVxyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdFx0XHR0ZXh0YXJlYS52YWwodGV4dCk7XHJcblx0XHRcdFx0dGV4dGFyZWEuY2hhbmdlKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHNlbGYuc2hvdyA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQuc2hvdygpOyB9O1xyXG5cdFx0XHRzZWxmLmhpZGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LmhpZGUoKTsgfTtcclxuXHRcdFx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRvZ2dsZSgpOyB9O1xyXG5cclxuXHRcdFx0Ly8gRXZlbnRzXHJcblx0XHRcdHNlbGYub24gPSB7IGNoYW5nZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy5jaGFuZ2UsIGNhbGxiYWNrKTsgfSB9O1xyXG5cdFx0XHRzZWxmLnRyaWdnZXIgPSB7IGNoYW5nZTogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuY2hhbmdlLCBkYXRhKSk7IH0gfTtcclxuXHJcblx0XHRcdC8vIENvbnN0cnVjdFxyXG5cclxuXHRcdFx0dmFyIG9uQ2hhbmdlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dmFyIHRleHQgPSB0ZXh0YXJlYS52YWwoKTtcclxuXHJcblx0XHRcdFx0cHJldmlldy5odG1sKGNvbnZlcnQodGV4dCkpO1xyXG5cdFx0XHRcdHNlbGYudHJpZ2dlci5jaGFuZ2UoeyB0ZXh0OiB0ZXh0IH0pO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dGV4dGFyZWEuY2hhbmdlKG9uQ2hhbmdlKS5rZXlkb3duKG9uQ2hhbmdlKS5rZXl1cChvbkNoYW5nZSk7XHJcblxyXG5cdFx0XHRzZWxmLnN0YXRlKHNlbGYuc3RhdGVzLmVkaXQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBFZGl0b3JGb290ZXIgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0XHR2YXIgcHJvcGVydHkgPSAnZGlzYWJsZWQnO1xyXG5cdFx0XHR2YXIgcmV2ZXJ0ID0gJCgnPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdFwiPlJldmVydCBjaGFuZ2VzPC9idXR0b24+Jyk7XHJcblx0XHRcdHZhciBzYXZlID0gJCgnPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc3VjY2VzcyBwdWxsLXJpZ2h0XCI+U2F2ZTwvYnV0dG9uPicpO1xyXG5cdFx0XHR2YXIgZXZlbnRzID0geyBzYXZlOiAnY20tZWRpdG9yLWZvb3Rlci1zYXZlJywgcmV2ZXJ0OiAnY20tZWRpdG9yLWZvb3Rlci1yZXZlcnQnIH07XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuZWxlbWVudCA9ICQoJzxkaXYgY2xhc3M9XCJjbS1lZGl0b3ItZm9vdGVyXCI+PC9kaXY+Jyk7XHJcblxyXG5cdFx0XHQvLyBNZXRob2RzXHJcblx0XHRcdHNlbGYuZGlzYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHNhdmUucHJvcChwcm9wZXJ0eSwgdHJ1ZSk7XHJcblx0XHRcdFx0cmV2ZXJ0LnByb3AocHJvcGVydHksIHRydWUpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi5lbmFibGUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRzYXZlLnByb3AocHJvcGVydHksIGZhbHNlKTtcclxuXHRcdFx0XHRyZXZlcnQucHJvcChwcm9wZXJ0eSwgZmFsc2UpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi5zaG93ID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC5zaG93KCk7IH07XHJcblx0XHRcdHNlbGYuaGlkZSA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQuaGlkZSgpOyB9O1xyXG5cdFx0XHRzZWxmLnRvZ2dsZSA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQudG9nZ2xlKCk7IH07XHJcblxyXG5cdFx0XHQvLyBFdmVudHNcclxuXHRcdFx0c2VsZi5vbiA9IHtcclxuXHRcdFx0XHRzYXZlOiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLnNhdmUsIGNhbGxiYWNrKTsgfSxcclxuXHRcdFx0XHRyZXZlcnQ6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMucmV2ZXJ0LCBjYWxsYmFjayk7IH0sXHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRzZWxmLnRyaWdnZXIgPSB7XHJcblx0XHRcdFx0c2F2ZTogZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5zYXZlKSk7IH0sXHJcblx0XHRcdFx0cmV2ZXJ0OiBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLnJldmVydCkpOyB9LFxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0LyogQ29uc3RydWN0ICovXHJcblx0XHRcdHNhdmUuY2xpY2soZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuc2F2ZSgpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHJldmVydC5jbGljayhmdW5jdGlvbihlKSB7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdHNlbGYudHJpZ2dlci5yZXZlcnQoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kKHJldmVydCkuYXBwZW5kKHNhdmUpO1xyXG5cdFx0XHRzZWxmLmRpc2FibGUoKTtcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIEVkaXRvciA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcclxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0XHR2YXIgdGV4dCA9ICcnO1xyXG5cclxuXHRcdFx0dmFyIGV2ZW50cyA9IHsgY2hhbmdlOiAnY20tZWRpdG9yLWNoYW5nZWQnLCBpbmxpbmVUb2dnbGU6ICdjbS1lZGl0b3ItaW5saW5lLXRvZ2dsZScgfTtcclxuXHJcblx0XHRcdC8qIFV0aWxpdHkgZnVuY3Rpb25zICovXHJcblx0XHRcdHZhciB0b2dnbGVJbmxpbmUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRjb250ZW50LnRvZ2dsZSgpO1xyXG5cdFx0XHRcdGlubGluZUNvbnRlbnQudG9nZ2xlKCk7XHJcblx0XHRcdFx0aGVhZGVyLnRvZ2dsZSgpO1xyXG5cclxuXHRcdFx0XHRpZihvcHRpb25zLnNhdmUpXHJcblx0XHRcdFx0XHRmb290ZXIudG9nZ2xlKCk7XHJcblxyXG5cdFx0XHRcdHNlbGYudHJpZ2dlci5pbmxpbmVUb2dnbGUoKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8qIFB1YmxpYyBBUEkgKi9cclxuXHRcdFx0c2VsZi5lbGVtZW50ID0gJChlbGVtZW50KTtcclxuXHJcblx0XHRcdC8vIE1ldGhvZHNcclxuXHRcdFx0c2VsZi50ZXh0ID0gZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0XHRpZih0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKVxyXG5cdFx0XHRcdFx0cmV0dXJuIHRleHQ7XHJcblxyXG5cdFx0XHRcdGlmKHRleHQgPT09IHZhbHVlKSByZXR1cm47XHJcblxyXG5cdFx0XHRcdHRleHQgPSB2YWx1ZTtcclxuXHRcdFx0XHRjb250ZW50LnRleHQodGV4dCk7XHJcblxyXG5cdFx0XHRcdGlmKGlubGluZUNvbnRlbnQpXHJcblx0XHRcdFx0XHRpbmxpbmVDb250ZW50Lmh0bWwoY29udmVydCh0ZXh0KSk7XHJcblxyXG5cdFx0XHRcdHNlbGYudHJpZ2dlci5jaGFuZ2UoeyB0ZXh0OiB0ZXh0IH0pO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi5pbmxpbmUgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG5cdFx0XHRcdGlmKCFvcHRpb25zLmlubGluZSlcclxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0XHRcdFx0dmFyIGlzSW5saW5lID0gaW5saW5lQ29udGVudC5pcygnOnZpc2libGUnKTtcclxuXHJcblx0XHRcdFx0aWYodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJylcclxuXHRcdFx0XHRcdHJldHVybiBpc0lubGluZTtcclxuXHJcblx0XHRcdFx0aWYoaXNJbmxpbmUgIT0gdmFsdWUpXHJcblx0XHRcdFx0XHR0b2dnbGVJbmxpbmUoKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8vIEV2ZW50c1xyXG5cclxuXHRcdFx0c2VsZi5vbiA9IHtcclxuXHRcdFx0XHRjaGFuZ2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMuY2hhbmdlLCBjYWxsYmFjayk7IH0sXHJcblx0XHRcdFx0aW5saW5lVG9nZ2xlOiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmlubGluZVRvZ2dsZSwgY2FsbGJhY2spOyB9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRzZWxmLnRyaWdnZXIgPSB7XHJcblx0XHRcdFx0Y2hhbmdlOiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5jaGFuZ2UsIGRhdGEpKTsgfSxcclxuXHRcdFx0XHRpbmxpbmVUb2dnbGU6IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuaW5saW5lVG9nZ2xlKSk7IH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8qIENvbnN0cnVjdG9yICovXHJcblx0XHRcdHZhciBoZWFkZXIgPSBuZXcgRWRpdG9ySGVhZGVyKG9wdGlvbnMpO1xyXG5cdFx0XHR2YXIgY29udGVudCA9IG5ldyBFZGl0b3JDb250ZW50KG9wdGlvbnMpO1xyXG5cdFx0XHR2YXIgZm9vdGVyID0gb3B0aW9ucy5zYXZlID8gbmV3IEVkaXRvckZvb3RlcigpIDogbnVsbDtcclxuXHRcdFx0dmFyIGlubGluZUNvbnRlbnQgPSBvcHRpb25zLmlubGluZSA/ICQoJzxkaXYgY2xhc3M9XCJpbmxpbmUtY29udGVudFwiPjwvZGl2PicpIDogbnVsbDtcclxuXHJcblx0XHRcdC8vIFN1YnNjcmliZSB0byBldmVudHNcclxuXHJcblx0XHRcdGhlYWRlci5vbi5lZGl0KGZ1bmN0aW9uKCkgeyBjb250ZW50LnN0YXRlKGNvbnRlbnQuc3RhdGVzLmVkaXQpOyB9KTtcclxuXHRcdFx0aGVhZGVyLm9uLnByZXZpZXcoZnVuY3Rpb24oKSB7IGNvbnRlbnQuc3RhdGUoY29udGVudC5zdGF0ZXMucHJldmlldyk7IH0pO1xyXG5cclxuXHRcdFx0Y29udGVudC5vbi5jaGFuZ2UoZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0XHRcdGlmKG9wdGlvbnMuc2F2ZSkge1xyXG5cdFx0XHRcdFx0aWYoZGF0YS50ZXh0ID09PSB0ZXh0KSBmb290ZXIuZGlzYWJsZSgpO1xyXG5cdFx0XHRcdFx0ZWxzZSBmb290ZXIuZW5hYmxlKCk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHNlbGYudGV4dChkYXRhLnRleHQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLnNhdmUpIHtcclxuXHRcdFx0XHRmb290ZXIub24uc2F2ZShmdW5jdGlvbigpIHsgc2VsZi50ZXh0KGNvbnRlbnQudGV4dCgpKTsgfSk7XHJcblx0XHRcdFx0Zm9vdGVyLm9uLnJldmVydChmdW5jdGlvbigpIHsgY29udGVudC50ZXh0KHNlbGYudGV4dCgpKTsgfSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmKG9wdGlvbnMuaW5saW5lKSB7XHJcblx0XHRcdFx0Y29udGVudC5oaWRlKCk7XHJcblxyXG5cdFx0XHRcdGlmKG9wdGlvbnMuc2F2ZSlcclxuXHRcdFx0XHRcdGZvb3Rlci5oaWRlKCk7XHJcblxyXG5cdFx0XHRcdGhlYWRlci5vbi50b2dnbGUodG9nZ2xlSW5saW5lKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gQWRkIGFsbCB0aGUgZWxlbWVudHNcclxuXHRcdFx0dmFyIGJvZHkgPSAkKCc8ZGl2IGNsYXNzPVwiY20tZWRpdG9yLWJvZHlcIj48L2Rpdj4nKS5hcHBlbmQoY29udGVudC5lbGVtZW50KTtcclxuXHJcblx0XHRcdGlmKGZvb3RlcilcclxuXHRcdFx0XHRib2R5LmFwcGVuZChmb290ZXIuZWxlbWVudCk7XHJcblxyXG5cdFx0XHRpZihpbmxpbmVDb250ZW50KVxyXG5cdFx0XHRcdGJvZHkuYXBwZW5kKGlubGluZUNvbnRlbnQpO1xyXG5cclxuXHRcdFx0c2VsZi5lbGVtZW50LmFkZENsYXNzKCdjb21tb25tYXJrLWVkaXRvcicpXHJcblx0XHRcdFx0LmFwcGVuZChoZWFkZXIuZWxlbWVudClcclxuXHRcdFx0XHQuYXBwZW5kKGJvZHkpO1xyXG5cclxuXHRcdFx0c2VsZi50ZXh0KG9wdGlvbnMudGV4dCk7XHJcblx0XHR9XHJcblxyXG5cdFx0JC5mbi5jb21tb25NYXJrRWRpdG9yID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdFx0XHRvcHRpb25zID0gJC5leHRlbmQoe1xyXG5cdFx0XHRcdGhlYWRlcjogdHJ1ZSxcclxuXHRcdFx0XHRpbmxpbmU6IGZhbHNlLFxyXG5cdFx0XHRcdG5hbWU6IG51bGwsXHJcblx0XHRcdFx0c2F2ZTogZmFsc2UsXHJcblx0XHRcdFx0dGV4dDogJycsXHJcblx0XHRcdFx0dGl0bGU6ICcnLFxyXG5cdFx0XHRcdHRvZ2dsZTogdHJ1ZVxyXG5cdFx0XHR9LCBvcHRpb25zKTtcclxuXHJcblx0XHRcdHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihpbmRleCwgaXRlbSkgeyByZXR1cm4gbmV3IEVkaXRvcihpdGVtLCBvcHRpb25zKTsgfSk7XHJcblx0XHR9O1xyXG5cdH07XHJcblxyXG5cdGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcclxuXHRcdGRlZmluZShbICdqcXVlcnknLCAnY29tbW9ubWFyaycgXSwgaW5pdCk7XHJcblx0ZWxzZVxyXG5cdFx0aW5pdChqUXVlcnksIGNvbW1vbm1hcmspXHJcbn0pKCk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
