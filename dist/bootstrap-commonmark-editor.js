/*! bootstrap-commonmark-editor 0.4.0 Copyright (c) 2014, 2015 Mike Lowen */
!function(){var e=function(e,n){var t=n.Parser(),i=n.HtmlRenderer(),o=function(e){return i.render(t.parse(e))},r=function(n){var t=this,i={preview:"cm-editor-header-preview",edit:"cm-editor-header-edit",toggle:"cm-editor-header-toggle"};t.element=e('<div class="cm-editor-header"></div>'),t.on={preview:function(e){t.element.on(i.preview,e)},edit:function(e){t.element.on(i.edit,e)},toggle:function(e){t.element.on(i.toggle,e)}},t.trigger={preview:function(n){t.element.trigger(new e.Event(i.preview,n))},edit:function(n){t.element.trigger(new e.Event(i.edit,n))},toggle:function(n){t.element.trigger(new e.Event(i.toggle))}},t.toggle=function(){n.toggle&&(g.hasClass(l)?g.removeClass(l).addClass(a):g.removeClass(a).addClass(l)),r&&r.toggle(),o.toggle()};var o=e('<ul class="tabs"></ul>').append(e("<li></li>").append(e('<a href="#" class="active">Edit</a>').click(function(){return t.trigger.edit({element:this}),!1}))).append(e("<li></li>").append(e('<a href="#">Preview</a>').click(function(){return t.trigger.preview({element:this}),!1})));if(n.inline){var r=null;if(n.toggle){var l="glyphicon-pencil",a="glyphicon-remove",g=e('<span class="glyphicon"></span>').addClass(l),c=e('<a href="#" class="pull-right toggle"></a>').append(g);c.click(function(e){e.preventDefault(),t.trigger.toggle()}),t.element.append(c)}o.hide(),n.title&&(r=e('<strong class="title"></strong>').text(n.title),t.element.append(r))}n.header||t.element.addClass("transparent"),t.element.append(o);var d=function(n){t.element.find("li a.active").removeClass("active"),e(n.element).addClass("active")};t.on.edit(d),t.on.preview(d)},l=function(n){var t=this,i=null,r={change:"cm-editor-content-change"},l=e('<textarea class="form-control"></textarea>'),a=e('<div class="preview"></div>');n.name&&l.attr("name",n.name),t.states={edit:1,preview:2},t.element=e('<div class="cm-editor-content"></div>').append(l).append(a),t.state=function(e){return"undefined"==typeof e?i:void(e!=i&&(i=e,i==t.states.edit?(l.show(),a.hide()):(l.hide(),a.show())))},t.text=function(e){return"undefined"==typeof e?l.val():void(l.val()!==e&&(l.val(e),l.change()))},t.show=function(){t.element.show()},t.hide=function(){t.element.hide()},t.toggle=function(){t.element.toggle()},t.on={change:function(e){t.element.on(r.change,e)}},t.trigger={change:function(n){t.element.trigger(new e.Event(r.change,n))}};var g=function(){var e=l.val();a.html(o(e)),t.trigger.change({text:e})};l.change(g).keydown(g).keyup(g),t.state(t.states.edit)},a=function(){var n=this,t="disabled",i=e('<button class="btn btn-default">Revert changes</button>'),o=e('<button class="btn btn-success pull-right">Save</button>'),r={save:"cm-editor-footer-save",revert:"cm-editor-footer-revert"};n.element=e('<div class="cm-editor-footer"></div>'),n.disable=function(){o.prop(t,!0),i.prop(t,!0)},n.enable=function(){o.prop(t,!1),i.prop(t,!1)},n.show=function(){n.element.show()},n.hide=function(){n.element.hide()},n.toggle=function(){n.element.toggle()},n.on={save:function(e){n.element.on(r.save,e)},revert:function(e){n.element.on(r.revert,e)}},n.trigger={save:function(){n.element.trigger(new e.Event(r.save))},revert:function(){n.element.trigger(new e.Event(r.revert))}},o.click(function(e){e.preventDefault(),n.trigger.save()}),i.click(function(e){e.preventDefault(),n.trigger.revert()}),n.element.append(i).append(o),n.disable()},g=function(n,t){var i=this,g="",c={change:"cm-editor-changed",inlineToggle:"cm-editor-inline-toggle"},d=function(){v.toggle(),f.toggle(),s.toggle(),t.save&&u.toggle(),i.trigger.inlineToggle()};i.element=e(n),i.text=function(e){return"undefined"==typeof e?g:void(g!==e&&(g=e,v.text(g),f&&f.html(o(g)),i.trigger.change({text:g})))},i.inline=function(e){if(!t.inline)return!1;var n=f.is(":visible");return"undefined"==typeof e?n:void(n!=e&&d())},i.on={change:function(e){i.element.on(c.change,e)},inlineToggle:function(e){i.element.on(c.inlineToggle,e)}},i.trigger={change:function(n){i.element.trigger(new e.Event(c.change,n))},inlineToggle:function(){i.element.trigger(new e.Event(c.inlineToggle))}};var s=new r(t),v=new l(t),u=t.save?new a:null,f=t.inline?e('<div class="inline-content"></div>'):null;s.on.edit(function(){v.state(v.states.edit)}),s.on.preview(function(){v.state(v.states.preview)}),v.on.change(function(e){t.save?e.text===g?u.disable():u.enable():i.text(e.text)}),t.save&&(u.on.save(function(){i.text(v.text())}),u.on.revert(function(){v.text(i.text())})),t.inline&&(v.hide(),t.save&&u.hide(),s.on.toggle(d));var m=e('<div class="cm-editor-body"></div>').append(v.element);u&&m.append(u.element),f&&m.append(f),i.element.addClass("commonmark-editor").append(s.element).append(m),i.text(t.text)};e.fn.commonMarkEditor=function(n){return n=e.extend({header:!0,inline:!1,name:null,save:!1,text:"",title:"",toggle:!0},n),this.map(function(e,t){return new g(t,n)})}};"function"==typeof define&&define.amd?define(["jquery","commonmark"],e):e(jQuery,commonmark)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb3RzdHJhcC1jb21tb25tYXJrLWVkaXRvci5qcyIsInByZWZpeC5qcyIsImhlYWRlci5qcyIsImNvbnRlbnQuanMiLCJmb290ZXIuanMiLCJlZGl0b3IuanMiLCJiaW5kaW5nLmpzIiwic3VmZml4LmpzIl0sIm5hbWVzIjpbImluaXQiLCIkIiwiY29tbW9ubWFyayIsInJlYWRlciIsIlBhcnNlciIsIndyaXRlciIsIkh0bWxSZW5kZXJlciIsImNvbnZlcnQiLCJzdHIiLCJyZW5kZXIiLCJwYXJzZSIsIkVkaXRvckhlYWRlciIsIm9wdGlvbnMiLCJzZWxmIiwidGhpcyIsImV2ZW50cyIsInByZXZpZXciLCJlZGl0IiwidG9nZ2xlIiwiZWxlbWVudCIsIm9uIiwiY2FsbGJhY2siLCJ0cmlnZ2VyIiwiZGF0YSIsIkV2ZW50IiwiZ2x5cGgiLCJoYXNDbGFzcyIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJjYW5jZWwiLCJ0aXRsZSIsInRhYnMiLCJhcHBlbmQiLCJjbGljayIsImlubGluZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImhpZGUiLCJ0ZXh0IiwiaGVhZGVyIiwiZmluZCIsIkVkaXRvckNvbnRlbnQiLCJzdGF0ZSIsImNoYW5nZSIsInRleHRhcmVhIiwibmFtZSIsImF0dHIiLCJzdGF0ZXMiLCJzIiwic2hvdyIsInZhbCIsIm9uQ2hhbmdlIiwiaHRtbCIsImtleWRvd24iLCJrZXl1cCIsIkVkaXRvckZvb3RlciIsInByb3BlcnR5IiwicmV2ZXJ0Iiwic2F2ZSIsImRpc2FibGUiLCJwcm9wIiwiZW5hYmxlIiwiRWRpdG9yIiwiaW5saW5lVG9nZ2xlIiwidG9nZ2xlSW5saW5lIiwiY29udGVudCIsImlubGluZUNvbnRlbnQiLCJmb290ZXIiLCJ2YWx1ZSIsImlzSW5saW5lIiwiaXMiLCJib2R5IiwiZm4iLCJjb21tb25NYXJrRWRpdG9yIiwiZXh0ZW5kIiwibWFwIiwiaW5kZXgiLCJpdGVtIiwiZGVmaW5lIiwiYW1kIiwialF1ZXJ5Il0sIm1hcHBp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QUFBM0IsS0FBQXpCLEVBQUF5QixXQUdBMUIsRUFBQXNCLFNBQ0ErQixFQUFBNUIsT0FFQXpCLEVBQUE4QyxNQUNBUyxFQUFBOUIsT0FFQUUsRUFBQW5CLEdBQUFGLE9BQUE4QyxHQUlBLElBQUFPLEdBQUF0RSxFQUFBLHNDQUFBK0IsT0FBQWlDLEVBQUE5QyxRQUVBZ0QsSUFDQUksRUFBQXZDLE9BQUFtQyxFQUFBaEQsU0FFQStDLEdBQ0FLLEVBQUF2QyxPQUFBa0MsR0FFQXJELEVBQUFNLFFBQUFTLFNBQUEscUJBQ0FJLE9BQUFPLEVBQUFwQixTQUNBYSxPQUFBdUMsR0FFQTFELEVBQUF5QixLQUFBMUIsRUFBQTBCLE1DN0dBckMsR0FBQXVFLEdBQUFDLGlCQUFBLFNBQUE3RCxHQVdBLE1BVkFBLEdBQUFYLEVBQUF5RSxRQUNBbkMsUUFBQSxFQUNBTCxRQUFBLEVBQ0FXLEtBQUEsS0FDQWEsTUFBQSxFQUNBcEIsS0FBQSxHQUNBUixNQUFBLEdBQ0FaLFFBQUEsR0FDQU4sR0FFQUUsS0FBQTZELElBQUEsU0FBQUMsRUFBQUMsR0FBQSxNQUFBLElBQUFmLEdBQUFlLEVBQUFqRSxNQ1RBLG1CQUFBa0UsU0FBQUEsT0FBQUMsSUFDQUQsUUFBQSxTQUFBLGNBQUE5RSxHQUVBQSxFQUFBZ0YsT0FBQTlFIiwiZmlsZSI6ImJvb3RzdHJhcC1jb21tb25tYXJrLWVkaXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcclxuXHR2YXIgaW5pdCA9IGZ1bmN0aW9uKCQsIGNvbW1vbm1hcmspIHtcclxuXHRcdHZhciByZWFkZXIgPSBjb21tb25tYXJrLlBhcnNlcigpO1xyXG5cdFx0dmFyIHdyaXRlciA9IGNvbW1vbm1hcmsuSHRtbFJlbmRlcmVyKCk7XHJcblxyXG5cdFx0dmFyIGNvbnZlcnQgPSBmdW5jdGlvbiAoc3RyKSB7IHJldHVybiB3cml0ZXIucmVuZGVyKHJlYWRlci5wYXJzZShzdHIpKTsgfTtcclxuXHJcblx0XHR2YXIgRWRpdG9ySGVhZGVyID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0XHRcdHZhciBldmVudHMgPSB7IHByZXZpZXc6ICdjbS1lZGl0b3ItaGVhZGVyLXByZXZpZXcnLCBlZGl0OiAnY20tZWRpdG9yLWhlYWRlci1lZGl0JywgdG9nZ2xlOiAnY20tZWRpdG9yLWhlYWRlci10b2dnbGUnIH07XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuZWxlbWVudCA9ICQoJzxkaXYgY2xhc3M9XCJjbS1lZGl0b3ItaGVhZGVyXCI+PC9kaXY+Jyk7XHJcblxyXG5cdFx0XHQvLyBFdmVudHNcclxuXHRcdFx0c2VsZi5vbiA9IHtcclxuXHRcdFx0XHRwcmV2aWV3OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLnByZXZpZXcsIGNhbGxiYWNrKTsgfSxcclxuXHRcdFx0XHRlZGl0OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmVkaXQsIGNhbGxiYWNrKTsgfSxcclxuXHRcdFx0XHR0b2dnbGU6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMudG9nZ2xlLCBjYWxsYmFjayk7IH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYudHJpZ2dlciA9IHtcclxuXHRcdFx0XHRwcmV2aWV3OiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5wcmV2aWV3LCBkYXRhKSk7IH0sXHJcblx0XHRcdFx0ZWRpdDogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuZWRpdCwgZGF0YSkpOyB9LFxyXG5cdFx0XHRcdHRvZ2dsZTogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMudG9nZ2xlKSk7IH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYudG9nZ2xlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0aWYob3B0aW9ucy50b2dnbGUpIHtcclxuXHRcdFx0XHRcdGlmKGdseXBoLmhhc0NsYXNzKGVkaXQpKSB7XHJcblx0XHRcdFx0XHRcdGdseXBoLnJlbW92ZUNsYXNzKGVkaXQpLmFkZENsYXNzKGNhbmNlbCk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRnbHlwaC5yZW1vdmVDbGFzcyhjYW5jZWwpLmFkZENsYXNzKGVkaXQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYodGl0bGUpIHRpdGxlLnRvZ2dsZSgpO1xyXG5cclxuXHRcdFx0XHR0YWJzLnRvZ2dsZSgpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0LyogQ29uc3RydWN0b3IgKi9cclxuXHJcblx0XHRcdHZhciB0YWJzID0gJCgnPHVsIGNsYXNzPVwidGFic1wiPjwvdWw+JylcclxuXHRcdFx0XHQuYXBwZW5kKFxyXG5cdFx0XHRcdFx0JCgnPGxpPjwvbGk+JykuYXBwZW5kKFxyXG5cdFx0XHRcdFx0XHQkKCc8YSBocmVmPVwiI1wiIGNsYXNzPVwiYWN0aXZlXCI+RWRpdDwvYT4nKS5jbGljayhmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIuZWRpdCh7IGVsZW1lbnQ6IHRoaXMgfSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdClcclxuXHRcdFx0XHQpXHJcblx0XHRcdFx0LmFwcGVuZChcclxuXHRcdFx0XHRcdCQoJzxsaT48L2xpPicpLmFwcGVuZChcclxuXHRcdFx0XHRcdFx0JCgnPGEgaHJlZj1cIiNcIj5QcmV2aWV3PC9hPicpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlci5wcmV2aWV3KHsgZWxlbWVudDogdGhpcyB9KTtcclxuXHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0KVxyXG5cdFx0XHRcdCk7XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLmlubGluZSkge1xyXG5cdFx0XHRcdHZhciB0aXRsZSA9IG51bGw7XHJcblxyXG5cdFx0XHRcdGlmKG9wdGlvbnMudG9nZ2xlKSB7XHJcblx0XHRcdFx0XHR2YXIgZWRpdCA9ICdnbHlwaGljb24tcGVuY2lsJztcclxuXHRcdFx0XHRcdHZhciBjYW5jZWwgPSAnZ2x5cGhpY29uLXJlbW92ZSc7XHJcblxyXG5cdFx0XHRcdFx0dmFyIGdseXBoID0gJCgnPHNwYW4gY2xhc3M9XCJnbHlwaGljb25cIj48L3NwYW4+JykuYWRkQ2xhc3MoZWRpdCk7XHJcblx0XHRcdFx0XHR2YXIgdG9nZ2xlID0gJCgnPGEgaHJlZj1cIiNcIiBjbGFzcz1cInB1bGwtcmlnaHQgdG9nZ2xlXCI+PC9hPicpLmFwcGVuZChnbHlwaCk7XHJcblxyXG5cdFx0XHRcdFx0dG9nZ2xlLmNsaWNrKGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0XHRzZWxmLnRyaWdnZXIudG9nZ2xlKCk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRzZWxmLmVsZW1lbnQuYXBwZW5kKHRvZ2dsZSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR0YWJzLmhpZGUoKTtcclxuXHJcblx0XHRcdFx0aWYob3B0aW9ucy50aXRsZSkge1xyXG5cdFx0XHRcdFx0dGl0bGUgPSAkKCc8c3Ryb25nIGNsYXNzPVwidGl0bGVcIj48L3N0cm9uZz4nKS50ZXh0KG9wdGlvbnMudGl0bGUpO1xyXG5cdFx0XHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZCh0aXRsZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZighb3B0aW9ucy5oZWFkZXIpXHJcblx0XHRcdFx0c2VsZi5lbGVtZW50LmFkZENsYXNzKCd0cmFuc3BhcmVudCcpO1xyXG5cclxuXHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZCh0YWJzKTtcclxuXHJcblx0XHRcdC8vIFRpZSB1cCBpbnRlcm5hbCBldmVudHNcclxuXHRcdFx0dmFyIGNsaWNrID0gZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0XHRcdHNlbGYuZWxlbWVudC5maW5kKCdsaSBhLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuXHRcdFx0XHQkKGRhdGEuZWxlbWVudCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi5vbi5lZGl0KGNsaWNrKTtcclxuXHRcdFx0c2VsZi5vbi5wcmV2aWV3KGNsaWNrKTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgRWRpdG9yQ29udGVudCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0XHR2YXIgc3RhdGUgPSBudWxsO1xyXG5cdFx0XHR2YXIgZXZlbnRzID0geyBjaGFuZ2U6ICdjbS1lZGl0b3ItY29udGVudC1jaGFuZ2UnIH07XHJcblxyXG5cdFx0XHR2YXIgdGV4dGFyZWEgPSAkKCc8dGV4dGFyZWEgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIj48L3RleHRhcmVhPicpO1xyXG5cdFx0XHR2YXIgcHJldmlldyA9ICQoJzxkaXYgY2xhc3M9XCJwcmV2aWV3XCI+PC9kaXY+Jyk7XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLm5hbWUpXHJcblx0XHRcdFx0dGV4dGFyZWEuYXR0cignbmFtZScsIG9wdGlvbnMubmFtZSk7XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuc3RhdGVzID0geyBlZGl0OiAxLCBwcmV2aWV3OiAyIH1cclxuXHRcdFx0c2VsZi5lbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1jb250ZW50XCI+PC9kaXY+JylcclxuXHRcdFx0XHQuYXBwZW5kKHRleHRhcmVhKVxyXG5cdFx0XHRcdC5hcHBlbmQocHJldmlldyk7XHJcblxyXG5cdFx0XHQvLyBNZXRob2RzXHJcblx0XHRcdHNlbGYuc3RhdGUgPSBmdW5jdGlvbihzKSB7XHJcblx0XHRcdFx0aWYodHlwZW9mIHMgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gc3RhdGU7XHJcblx0XHRcdFx0aWYocyA9PSBzdGF0ZSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHRzdGF0ZSA9IHM7XHJcblxyXG5cdFx0XHRcdGlmKHN0YXRlID09IHNlbGYuc3RhdGVzLmVkaXQpIHtcclxuXHRcdFx0XHRcdHRleHRhcmVhLnNob3coKTtcclxuXHRcdFx0XHRcdHByZXZpZXcuaGlkZSgpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHR0ZXh0YXJlYS5oaWRlKCk7XHJcblx0XHRcdFx0XHRwcmV2aWV3LnNob3coKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHRzZWxmLnRleHQgPSBmdW5jdGlvbih0ZXh0KSB7XHJcblx0XHRcdFx0aWYodHlwZW9mIHRleHQgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gdGV4dGFyZWEudmFsKCk7XHJcblxyXG5cdFx0XHRcdC8vIExldHMgbm90IGNhdXNlIHVubmVjZXNzYXJ5IHJlc2V0dGluZyBvZiB0ZXh0IGFuZCBmaXJlIHVubmVlZGVkIGV2ZW50cy5cclxuXHRcdFx0XHRpZih0ZXh0YXJlYS52YWwoKSA9PT0gdGV4dClcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHJcblx0XHRcdFx0dGV4dGFyZWEudmFsKHRleHQpO1xyXG5cdFx0XHRcdHRleHRhcmVhLmNoYW5nZSgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzZWxmLnNob3cgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnNob3coKTsgfTtcclxuXHRcdFx0c2VsZi5oaWRlID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC5oaWRlKCk7IH07XHJcblx0XHRcdHNlbGYudG9nZ2xlID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50b2dnbGUoKTsgfTtcclxuXHJcblx0XHRcdC8vIEV2ZW50c1xyXG5cdFx0XHRzZWxmLm9uID0geyBjaGFuZ2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMuY2hhbmdlLCBjYWxsYmFjayk7IH0gfTtcclxuXHRcdFx0c2VsZi50cmlnZ2VyID0geyBjaGFuZ2U6IGZ1bmN0aW9uKGRhdGEpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLmNoYW5nZSwgZGF0YSkpOyB9IH07XHJcblxyXG5cdFx0XHQvLyBDb25zdHJ1Y3RcclxuXHJcblx0XHRcdHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdHZhciB0ZXh0ID0gdGV4dGFyZWEudmFsKCk7XHJcblxyXG5cdFx0XHRcdHByZXZpZXcuaHRtbChjb252ZXJ0KHRleHQpKTtcclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuY2hhbmdlKHsgdGV4dDogdGV4dCB9KTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHRleHRhcmVhLmNoYW5nZShvbkNoYW5nZSkua2V5ZG93bihvbkNoYW5nZSkua2V5dXAob25DaGFuZ2UpO1xyXG5cclxuXHRcdFx0c2VsZi5zdGF0ZShzZWxmLnN0YXRlcy5lZGl0KTtcclxuXHRcdH1cclxuXHJcblx0XHR2YXIgRWRpdG9yRm9vdGVyID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdFx0dmFyIHByb3BlcnR5ID0gJ2Rpc2FibGVkJztcclxuXHRcdFx0dmFyIHJldmVydCA9ICQoJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLWRlZmF1bHRcIj5SZXZlcnQgY2hhbmdlczwvYnV0dG9uPicpO1xyXG5cdFx0XHR2YXIgc2F2ZSA9ICQoJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXN1Y2Nlc3MgcHVsbC1yaWdodFwiPlNhdmU8L2J1dHRvbj4nKTtcclxuXHRcdFx0dmFyIGV2ZW50cyA9IHsgc2F2ZTogJ2NtLWVkaXRvci1mb290ZXItc2F2ZScsIHJldmVydDogJ2NtLWVkaXRvci1mb290ZXItcmV2ZXJ0JyB9O1xyXG5cclxuXHRcdFx0LyogUHVibGljIEFQSSAqL1xyXG5cdFx0XHRzZWxmLmVsZW1lbnQgPSAkKCc8ZGl2IGNsYXNzPVwiY20tZWRpdG9yLWZvb3RlclwiPjwvZGl2PicpO1xyXG5cclxuXHRcdFx0Ly8gTWV0aG9kc1xyXG5cdFx0XHRzZWxmLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRzYXZlLnByb3AocHJvcGVydHksIHRydWUpO1xyXG5cdFx0XHRcdHJldmVydC5wcm9wKHByb3BlcnR5LCB0cnVlKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYuZW5hYmxlID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0c2F2ZS5wcm9wKHByb3BlcnR5LCBmYWxzZSk7XHJcblx0XHRcdFx0cmV2ZXJ0LnByb3AocHJvcGVydHksIGZhbHNlKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYuc2hvdyA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQuc2hvdygpOyB9O1xyXG5cdFx0XHRzZWxmLmhpZGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LmhpZGUoKTsgfTtcclxuXHRcdFx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRvZ2dsZSgpOyB9O1xyXG5cclxuXHRcdFx0Ly8gRXZlbnRzXHJcblx0XHRcdHNlbGYub24gPSB7XHJcblx0XHRcdFx0c2F2ZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy5zYXZlLCBjYWxsYmFjayk7IH0sXHJcblx0XHRcdFx0cmV2ZXJ0OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLnJldmVydCwgY2FsbGJhY2spOyB9LFxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0XHRcdHNhdmU6IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuc2F2ZSkpOyB9LFxyXG5cdFx0XHRcdHJldmVydDogZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5yZXZlcnQpKTsgfSxcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8qIENvbnN0cnVjdCAqL1xyXG5cdFx0XHRzYXZlLmNsaWNrKGZ1bmN0aW9uKGUpIHtcclxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0c2VsZi50cmlnZ2VyLnNhdmUoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXZlcnQuY2xpY2soZnVuY3Rpb24oZSkge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIucmV2ZXJ0KCk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0c2VsZi5lbGVtZW50LmFwcGVuZChyZXZlcnQpLmFwcGVuZChzYXZlKTtcclxuXHRcdFx0c2VsZi5kaXNhYmxlKCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHZhciBFZGl0b3IgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XHJcblx0XHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdFx0dmFyIHRleHQgPSAnJztcclxuXHJcblx0XHRcdHZhciBldmVudHMgPSB7IGNoYW5nZTogJ2NtLWVkaXRvci1jaGFuZ2VkJywgaW5saW5lVG9nZ2xlOiAnY20tZWRpdG9yLWlubGluZS10b2dnbGUnIH07XHJcblxyXG5cdFx0XHQvKiBVdGlsaXR5IGZ1bmN0aW9ucyAqL1xyXG5cdFx0XHR2YXIgdG9nZ2xlSW5saW5lID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0Y29udGVudC50b2dnbGUoKTtcclxuXHRcdFx0XHRpbmxpbmVDb250ZW50LnRvZ2dsZSgpO1xyXG5cdFx0XHRcdGhlYWRlci50b2dnbGUoKTtcclxuXHJcblx0XHRcdFx0aWYob3B0aW9ucy5zYXZlKVxyXG5cdFx0XHRcdFx0Zm9vdGVyLnRvZ2dsZSgpO1xyXG5cclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuaW5saW5lVG9nZ2xlKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvKiBQdWJsaWMgQVBJICovXHJcblx0XHRcdHNlbGYuZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcblxyXG5cdFx0XHQvLyBNZXRob2RzXHJcblx0XHRcdHNlbGYudGV4dCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRcdFx0aWYodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJylcclxuXHRcdFx0XHRcdHJldHVybiB0ZXh0O1xyXG5cclxuXHRcdFx0XHRpZih0ZXh0ID09PSB2YWx1ZSkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHR0ZXh0ID0gdmFsdWU7XHJcblx0XHRcdFx0Y29udGVudC50ZXh0KHRleHQpO1xyXG5cclxuXHRcdFx0XHRpZihpbmxpbmVDb250ZW50KVxyXG5cdFx0XHRcdFx0aW5saW5lQ29udGVudC5odG1sKGNvbnZlcnQodGV4dCkpO1xyXG5cclxuXHRcdFx0XHRzZWxmLnRyaWdnZXIuY2hhbmdlKHsgdGV4dDogdGV4dCB9KTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHNlbGYuaW5saW5lID0gZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdFx0XHRpZighb3B0aW9ucy5pbmxpbmUpXHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblxyXG5cdFx0XHRcdHZhciBpc0lubGluZSA9IGlubGluZUNvbnRlbnQuaXMoJzp2aXNpYmxlJyk7XHJcblxyXG5cdFx0XHRcdGlmKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpXHJcblx0XHRcdFx0XHRyZXR1cm4gaXNJbmxpbmU7XHJcblxyXG5cdFx0XHRcdGlmKGlzSW5saW5lICE9IHZhbHVlKVxyXG5cdFx0XHRcdFx0dG9nZ2xlSW5saW5lKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyBFdmVudHNcclxuXHJcblx0XHRcdHNlbGYub24gPSB7XHJcblx0XHRcdFx0Y2hhbmdlOiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmNoYW5nZSwgY2FsbGJhY2spOyB9LFxyXG5cdFx0XHRcdGlubGluZVRvZ2dsZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy5pbmxpbmVUb2dnbGUsIGNhbGxiYWNrKTsgfVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0XHRcdGNoYW5nZTogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuY2hhbmdlLCBkYXRhKSk7IH0sXHJcblx0XHRcdFx0aW5saW5lVG9nZ2xlOiBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLmlubGluZVRvZ2dsZSkpOyB9XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvKiBDb25zdHJ1Y3RvciAqL1xyXG5cdFx0XHR2YXIgaGVhZGVyID0gbmV3IEVkaXRvckhlYWRlcihvcHRpb25zKTtcclxuXHRcdFx0dmFyIGNvbnRlbnQgPSBuZXcgRWRpdG9yQ29udGVudChvcHRpb25zKTtcclxuXHRcdFx0dmFyIGZvb3RlciA9IG9wdGlvbnMuc2F2ZSA/IG5ldyBFZGl0b3JGb290ZXIoKSA6IG51bGw7XHJcblx0XHRcdHZhciBpbmxpbmVDb250ZW50ID0gb3B0aW9ucy5pbmxpbmUgPyAkKCc8ZGl2IGNsYXNzPVwiaW5saW5lLWNvbnRlbnRcIj48L2Rpdj4nKSA6IG51bGw7XHJcblxyXG5cdFx0XHQvLyBTdWJzY3JpYmUgdG8gZXZlbnRzXHJcblxyXG5cdFx0XHRoZWFkZXIub24uZWRpdChmdW5jdGlvbigpIHsgY29udGVudC5zdGF0ZShjb250ZW50LnN0YXRlcy5lZGl0KTsgfSk7XHJcblx0XHRcdGhlYWRlci5vbi5wcmV2aWV3KGZ1bmN0aW9uKCkgeyBjb250ZW50LnN0YXRlKGNvbnRlbnQuc3RhdGVzLnByZXZpZXcpOyB9KTtcclxuXHJcblx0XHRcdGNvbnRlbnQub24uY2hhbmdlKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdFx0XHRpZihvcHRpb25zLnNhdmUpIHtcclxuXHRcdFx0XHRcdGlmKGRhdGEudGV4dCA9PT0gdGV4dCkgZm9vdGVyLmRpc2FibGUoKTtcclxuXHRcdFx0XHRcdGVsc2UgZm9vdGVyLmVuYWJsZSgpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRzZWxmLnRleHQoZGF0YS50ZXh0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0aWYob3B0aW9ucy5zYXZlKSB7XHJcblx0XHRcdFx0Zm9vdGVyLm9uLnNhdmUoZnVuY3Rpb24oKSB7IHNlbGYudGV4dChjb250ZW50LnRleHQoKSk7IH0pO1xyXG5cdFx0XHRcdGZvb3Rlci5vbi5yZXZlcnQoZnVuY3Rpb24oKSB7IGNvbnRlbnQudGV4dChzZWxmLnRleHQoKSk7IH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZihvcHRpb25zLmlubGluZSkge1xyXG5cdFx0XHRcdGNvbnRlbnQuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRpZihvcHRpb25zLnNhdmUpXHJcblx0XHRcdFx0XHRmb290ZXIuaGlkZSgpO1xyXG5cclxuXHRcdFx0XHRoZWFkZXIub24udG9nZ2xlKHRvZ2dsZUlubGluZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEFkZCBhbGwgdGhlIGVsZW1lbnRzXHJcblx0XHRcdHZhciBib2R5ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1ib2R5XCI+PC9kaXY+JykuYXBwZW5kKGNvbnRlbnQuZWxlbWVudCk7XHJcblxyXG5cdFx0XHRpZihmb290ZXIpXHJcblx0XHRcdFx0Ym9keS5hcHBlbmQoZm9vdGVyLmVsZW1lbnQpO1xyXG5cclxuXHRcdFx0aWYoaW5saW5lQ29udGVudClcclxuXHRcdFx0XHRib2R5LmFwcGVuZChpbmxpbmVDb250ZW50KTtcclxuXHJcblx0XHRcdHNlbGYuZWxlbWVudC5hZGRDbGFzcygnY29tbW9ubWFyay1lZGl0b3InKVxyXG5cdFx0XHRcdC5hcHBlbmQoaGVhZGVyLmVsZW1lbnQpXHJcblx0XHRcdFx0LmFwcGVuZChib2R5KTtcclxuXHJcblx0XHRcdHNlbGYudGV4dChvcHRpb25zLnRleHQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdCQuZm4uY29tbW9uTWFya0VkaXRvciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHRcdFx0b3B0aW9ucyA9ICQuZXh0ZW5kKHtcclxuXHRcdFx0XHRoZWFkZXI6IHRydWUsXHJcblx0XHRcdFx0aW5saW5lOiBmYWxzZSxcclxuXHRcdFx0XHRuYW1lOiBudWxsLFxyXG5cdFx0XHRcdHNhdmU6IGZhbHNlLFxyXG5cdFx0XHRcdHRleHQ6ICcnLFxyXG5cdFx0XHRcdHRpdGxlOiAnJyxcclxuXHRcdFx0XHR0b2dnbGU6IHRydWVcclxuXHRcdFx0fSwgb3B0aW9ucyk7XHJcblxyXG5cdFx0XHRyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oaW5kZXgsIGl0ZW0pIHsgcmV0dXJuIG5ldyBFZGl0b3IoaXRlbSwgb3B0aW9ucyk7IH0pO1xyXG5cdFx0fTtcclxuXHR9O1xyXG5cclxuXHRpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXHJcblx0XHRkZWZpbmUoWyAnanF1ZXJ5JywgJ2NvbW1vbm1hcmsnIF0sIGluaXQpO1xyXG5cdGVsc2VcclxuXHRcdGluaXQoalF1ZXJ5LCBjb21tb25tYXJrKVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcblx0dmFyIGluaXQgPSBmdW5jdGlvbigkLCBjb21tb25tYXJrKSB7XHJcblx0XHR2YXIgcmVhZGVyID0gY29tbW9ubWFyay5QYXJzZXIoKTtcclxuXHRcdHZhciB3cml0ZXIgPSBjb21tb25tYXJrLkh0bWxSZW5kZXJlcigpO1xyXG5cclxuXHRcdHZhciBjb252ZXJ0ID0gZnVuY3Rpb24gKHN0cikgeyByZXR1cm4gd3JpdGVyLnJlbmRlcihyZWFkZXIucGFyc2Uoc3RyKSk7IH07IiwidmFyIEVkaXRvckhlYWRlciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0dmFyIGV2ZW50cyA9IHsgcHJldmlldzogJ2NtLWVkaXRvci1oZWFkZXItcHJldmlldycsIGVkaXQ6ICdjbS1lZGl0b3ItaGVhZGVyLWVkaXQnLCB0b2dnbGU6ICdjbS1lZGl0b3ItaGVhZGVyLXRvZ2dsZScgfTtcclxuXHRcclxuXHQvKiBQdWJsaWMgQVBJICovXHJcblx0c2VsZi5lbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1oZWFkZXJcIj48L2Rpdj4nKTtcclxuXHRcclxuXHQvLyBFdmVudHNcclxuXHRzZWxmLm9uID0ge1xyXG5cdFx0cHJldmlldzogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy5wcmV2aWV3LCBjYWxsYmFjayk7IH0sXHJcblx0XHRlZGl0OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmVkaXQsIGNhbGxiYWNrKTsgfSxcclxuXHRcdHRvZ2dsZTogZnVuY3Rpb24oY2FsbGJhY2spIHsgc2VsZi5lbGVtZW50Lm9uKGV2ZW50cy50b2dnbGUsIGNhbGxiYWNrKTsgfVxyXG5cdH07XHJcblx0XHJcblx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0cHJldmlldzogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMucHJldmlldywgZGF0YSkpOyB9LFxyXG5cdFx0ZWRpdDogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuZWRpdCwgZGF0YSkpOyB9LFxyXG5cdFx0dG9nZ2xlOiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy50b2dnbGUpKTsgfVxyXG5cdH07XHJcblx0XHJcblx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbigpIHtcclxuXHRcdGlmKG9wdGlvbnMudG9nZ2xlKSB7XHJcblx0XHRcdGlmKGdseXBoLmhhc0NsYXNzKGVkaXQpKSB7XHJcblx0XHRcdFx0Z2x5cGgucmVtb3ZlQ2xhc3MoZWRpdCkuYWRkQ2xhc3MoY2FuY2VsKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRnbHlwaC5yZW1vdmVDbGFzcyhjYW5jZWwpLmFkZENsYXNzKGVkaXQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHJcblx0XHRpZih0aXRsZSkgdGl0bGUudG9nZ2xlKCk7XHJcblx0XHJcblx0XHR0YWJzLnRvZ2dsZSgpO1xyXG5cdH07XHJcblx0XHJcblx0LyogQ29uc3RydWN0b3IgKi9cclxuXHRcclxuXHR2YXIgdGFicyA9ICQoJzx1bCBjbGFzcz1cInRhYnNcIj48L3VsPicpXHJcblx0XHQuYXBwZW5kKFxyXG5cdFx0XHQkKCc8bGk+PC9saT4nKS5hcHBlbmQoXHJcblx0XHRcdFx0JCgnPGEgaHJlZj1cIiNcIiBjbGFzcz1cImFjdGl2ZVwiPkVkaXQ8L2E+JykuY2xpY2soZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRzZWxmLnRyaWdnZXIuZWRpdCh7IGVsZW1lbnQ6IHRoaXMgfSk7XHJcblx0XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fSlcclxuXHRcdFx0KVxyXG5cdFx0KVxyXG5cdFx0LmFwcGVuZChcclxuXHRcdFx0JCgnPGxpPjwvbGk+JykuYXBwZW5kKFxyXG5cdFx0XHRcdCQoJzxhIGhyZWY9XCIjXCI+UHJldmlldzwvYT4nKS5jbGljayhmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdHNlbGYudHJpZ2dlci5wcmV2aWV3KHsgZWxlbWVudDogdGhpcyB9KTtcclxuXHRcclxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHR9KVxyXG5cdFx0XHQpXHJcblx0XHQpO1xyXG5cdFxyXG5cdGlmKG9wdGlvbnMuaW5saW5lKSB7XHJcblx0XHR2YXIgdGl0bGUgPSBudWxsO1xyXG5cdFxyXG5cdFx0aWYob3B0aW9ucy50b2dnbGUpIHtcclxuXHRcdFx0dmFyIGVkaXQgPSAnZ2x5cGhpY29uLXBlbmNpbCc7XHJcblx0XHRcdHZhciBjYW5jZWwgPSAnZ2x5cGhpY29uLXJlbW92ZSc7XHJcblx0XHJcblx0XHRcdHZhciBnbHlwaCA9ICQoJzxzcGFuIGNsYXNzPVwiZ2x5cGhpY29uXCI+PC9zcGFuPicpLmFkZENsYXNzKGVkaXQpO1xyXG5cdFx0XHR2YXIgdG9nZ2xlID0gJCgnPGEgaHJlZj1cIiNcIiBjbGFzcz1cInB1bGwtcmlnaHQgdG9nZ2xlXCI+PC9hPicpLmFwcGVuZChnbHlwaCk7XHJcblx0XHJcblx0XHRcdHRvZ2dsZS5jbGljayhmdW5jdGlvbihlKSB7XHJcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdHNlbGYudHJpZ2dlci50b2dnbGUoKTtcclxuXHRcdFx0fSk7XHJcblx0XHJcblx0XHRcdHNlbGYuZWxlbWVudC5hcHBlbmQodG9nZ2xlKTtcclxuXHRcdH1cclxuXHRcclxuXHRcdHRhYnMuaGlkZSgpO1xyXG5cdFxyXG5cdFx0aWYob3B0aW9ucy50aXRsZSkge1xyXG5cdFx0XHR0aXRsZSA9ICQoJzxzdHJvbmcgY2xhc3M9XCJ0aXRsZVwiPjwvc3Ryb25nPicpLnRleHQob3B0aW9ucy50aXRsZSk7XHJcblx0XHRcdHNlbGYuZWxlbWVudC5hcHBlbmQodGl0bGUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRpZighb3B0aW9ucy5oZWFkZXIpXHJcblx0XHRzZWxmLmVsZW1lbnQuYWRkQ2xhc3MoJ3RyYW5zcGFyZW50Jyk7XHJcblx0XHJcblx0c2VsZi5lbGVtZW50LmFwcGVuZCh0YWJzKTtcclxuXHRcclxuXHQvLyBUaWUgdXAgaW50ZXJuYWwgZXZlbnRzXHJcblx0dmFyIGNsaWNrID0gZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0c2VsZi5lbGVtZW50LmZpbmQoJ2xpIGEuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG5cdFx0JChkYXRhLmVsZW1lbnQpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuXHR9O1xyXG5cdFxyXG5cdHNlbGYub24uZWRpdChjbGljayk7XHJcblx0c2VsZi5vbi5wcmV2aWV3KGNsaWNrKTtcclxufSIsInZhciBFZGl0b3JDb250ZW50ID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdHZhciBzZWxmID0gdGhpcztcclxuXHR2YXIgc3RhdGUgPSBudWxsO1xyXG5cdHZhciBldmVudHMgPSB7IGNoYW5nZTogJ2NtLWVkaXRvci1jb250ZW50LWNoYW5nZScgfTtcclxuXHJcblx0dmFyIHRleHRhcmVhID0gJCgnPHRleHRhcmVhIGNsYXNzPVwiZm9ybS1jb250cm9sXCI+PC90ZXh0YXJlYT4nKTtcclxuXHR2YXIgcHJldmlldyA9ICQoJzxkaXYgY2xhc3M9XCJwcmV2aWV3XCI+PC9kaXY+Jyk7XHJcblxyXG5cdGlmKG9wdGlvbnMubmFtZSlcclxuXHRcdHRleHRhcmVhLmF0dHIoJ25hbWUnLCBvcHRpb25zLm5hbWUpO1xyXG5cclxuXHQvKiBQdWJsaWMgQVBJICovXHJcblx0c2VsZi5zdGF0ZXMgPSB7IGVkaXQ6IDEsIHByZXZpZXc6IDIgfVxyXG5cdHNlbGYuZWxlbWVudCA9ICQoJzxkaXYgY2xhc3M9XCJjbS1lZGl0b3ItY29udGVudFwiPjwvZGl2PicpXHJcblx0XHQuYXBwZW5kKHRleHRhcmVhKVxyXG5cdFx0LmFwcGVuZChwcmV2aWV3KTtcclxuXHJcblx0Ly8gTWV0aG9kc1xyXG5cdHNlbGYuc3RhdGUgPSBmdW5jdGlvbihzKSB7XHJcblx0XHRpZih0eXBlb2YgcyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiBzdGF0ZTtcclxuXHRcdGlmKHMgPT0gc3RhdGUpIHJldHVybjtcclxuXHJcblx0XHRzdGF0ZSA9IHM7XHJcblxyXG5cdFx0aWYoc3RhdGUgPT0gc2VsZi5zdGF0ZXMuZWRpdCkge1xyXG5cdFx0XHR0ZXh0YXJlYS5zaG93KCk7XHJcblx0XHRcdHByZXZpZXcuaGlkZSgpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGV4dGFyZWEuaGlkZSgpO1xyXG5cdFx0XHRwcmV2aWV3LnNob3coKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRzZWxmLnRleHQgPSBmdW5jdGlvbih0ZXh0KSB7XHJcblx0XHRpZih0eXBlb2YgdGV4dCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB0ZXh0YXJlYS52YWwoKTtcclxuXHJcblx0XHQvLyBMZXRzIG5vdCBjYXVzZSB1bm5lY2Vzc2FyeSByZXNldHRpbmcgb2YgdGV4dCBhbmQgZmlyZSB1bm5lZWRlZCBldmVudHMuXHJcblx0XHRpZih0ZXh0YXJlYS52YWwoKSA9PT0gdGV4dClcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdHRleHRhcmVhLnZhbCh0ZXh0KTtcclxuXHRcdHRleHRhcmVhLmNoYW5nZSgpO1xyXG5cdH1cclxuXHJcblx0c2VsZi5zaG93ID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC5zaG93KCk7IH07XHJcblx0c2VsZi5oaWRlID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC5oaWRlKCk7IH07XHJcblx0c2VsZi50b2dnbGUgPSBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRvZ2dsZSgpOyB9O1xyXG5cclxuXHQvLyBFdmVudHNcclxuXHRzZWxmLm9uID0geyBjaGFuZ2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMuY2hhbmdlLCBjYWxsYmFjayk7IH0gfTtcclxuXHRzZWxmLnRyaWdnZXIgPSB7IGNoYW5nZTogZnVuY3Rpb24oZGF0YSkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuY2hhbmdlLCBkYXRhKSk7IH0gfTtcclxuXHJcblx0Ly8gQ29uc3RydWN0XHJcblxyXG5cdHZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIHRleHQgPSB0ZXh0YXJlYS52YWwoKTtcclxuXHJcblx0XHRwcmV2aWV3Lmh0bWwoY29udmVydCh0ZXh0KSk7XHJcblx0XHRzZWxmLnRyaWdnZXIuY2hhbmdlKHsgdGV4dDogdGV4dCB9KTtcclxuXHR9O1xyXG5cclxuXHR0ZXh0YXJlYS5jaGFuZ2Uob25DaGFuZ2UpLmtleWRvd24ob25DaGFuZ2UpLmtleXVwKG9uQ2hhbmdlKTtcclxuXHJcblx0c2VsZi5zdGF0ZShzZWxmLnN0YXRlcy5lZGl0KTtcclxufSIsInZhciBFZGl0b3JGb290ZXIgPSBmdW5jdGlvbigpIHtcclxuXHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0dmFyIHByb3BlcnR5ID0gJ2Rpc2FibGVkJztcclxuXHR2YXIgcmV2ZXJ0ID0gJCgnPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdFwiPlJldmVydCBjaGFuZ2VzPC9idXR0b24+Jyk7XHJcblx0dmFyIHNhdmUgPSAkKCc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zdWNjZXNzIHB1bGwtcmlnaHRcIj5TYXZlPC9idXR0b24+Jyk7XHJcblx0dmFyIGV2ZW50cyA9IHsgc2F2ZTogJ2NtLWVkaXRvci1mb290ZXItc2F2ZScsIHJldmVydDogJ2NtLWVkaXRvci1mb290ZXItcmV2ZXJ0JyB9O1xyXG5cclxuXHQvKiBQdWJsaWMgQVBJICovXHJcblx0c2VsZi5lbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImNtLWVkaXRvci1mb290ZXJcIj48L2Rpdj4nKTtcclxuXHJcblx0Ly8gTWV0aG9kc1xyXG5cdHNlbGYuZGlzYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0c2F2ZS5wcm9wKHByb3BlcnR5LCB0cnVlKTtcclxuXHRcdHJldmVydC5wcm9wKHByb3BlcnR5LCB0cnVlKTtcclxuXHR9O1xyXG5cclxuXHRzZWxmLmVuYWJsZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0c2F2ZS5wcm9wKHByb3BlcnR5LCBmYWxzZSk7XHJcblx0XHRyZXZlcnQucHJvcChwcm9wZXJ0eSwgZmFsc2UpO1xyXG5cdH07XHJcblxyXG5cdHNlbGYuc2hvdyA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQuc2hvdygpOyB9O1xyXG5cdHNlbGYuaGlkZSA9IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQuaGlkZSgpOyB9O1xyXG5cdHNlbGYudG9nZ2xlID0gZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50b2dnbGUoKTsgfTtcclxuXHJcblx0Ly8gRXZlbnRzXHJcblx0c2VsZi5vbiA9IHtcclxuXHRcdHNhdmU6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7IHNlbGYuZWxlbWVudC5vbihldmVudHMuc2F2ZSwgY2FsbGJhY2spOyB9LFxyXG5cdFx0cmV2ZXJ0OiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLnJldmVydCwgY2FsbGJhY2spOyB9LFxyXG5cdH07XHJcblxyXG5cdHNlbGYudHJpZ2dlciA9IHtcclxuXHRcdHNhdmU6IGZ1bmN0aW9uKCkgeyBzZWxmLmVsZW1lbnQudHJpZ2dlcihuZXcgJC5FdmVudChldmVudHMuc2F2ZSkpOyB9LFxyXG5cdFx0cmV2ZXJ0OiBmdW5jdGlvbigpIHsgc2VsZi5lbGVtZW50LnRyaWdnZXIobmV3ICQuRXZlbnQoZXZlbnRzLnJldmVydCkpOyB9LFxyXG5cdH07XHJcblxyXG5cdC8qIENvbnN0cnVjdCAqL1xyXG5cdHNhdmUuY2xpY2soZnVuY3Rpb24oZSkge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0c2VsZi50cmlnZ2VyLnNhdmUoKTtcclxuXHR9KTtcclxuXHJcblx0cmV2ZXJ0LmNsaWNrKGZ1bmN0aW9uKGUpIHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdHNlbGYudHJpZ2dlci5yZXZlcnQoKTtcclxuXHR9KTtcclxuXHJcblx0c2VsZi5lbGVtZW50LmFwcGVuZChyZXZlcnQpLmFwcGVuZChzYXZlKTtcclxuXHRzZWxmLmRpc2FibGUoKTtcclxufTsiLCJ2YXIgRWRpdG9yID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xyXG5cdHZhciBzZWxmID0gdGhpcztcclxuXHR2YXIgdGV4dCA9ICcnO1xyXG5cclxuXHR2YXIgZXZlbnRzID0geyBjaGFuZ2U6ICdjbS1lZGl0b3ItY2hhbmdlZCcsIGlubGluZVRvZ2dsZTogJ2NtLWVkaXRvci1pbmxpbmUtdG9nZ2xlJyB9O1xyXG5cclxuXHQvKiBVdGlsaXR5IGZ1bmN0aW9ucyAqL1xyXG5cdHZhciB0b2dnbGVJbmxpbmUgPSBmdW5jdGlvbigpIHtcclxuXHRcdGNvbnRlbnQudG9nZ2xlKCk7XHJcblx0XHRpbmxpbmVDb250ZW50LnRvZ2dsZSgpO1xyXG5cdFx0aGVhZGVyLnRvZ2dsZSgpO1xyXG5cclxuXHRcdGlmKG9wdGlvbnMuc2F2ZSlcclxuXHRcdFx0Zm9vdGVyLnRvZ2dsZSgpO1xyXG5cclxuXHRcdHNlbGYudHJpZ2dlci5pbmxpbmVUb2dnbGUoKTtcclxuXHR9O1xyXG5cclxuXHQvKiBQdWJsaWMgQVBJICovXHJcblx0c2VsZi5lbGVtZW50ID0gJChlbGVtZW50KTtcclxuXHJcblx0Ly8gTWV0aG9kc1xyXG5cdHNlbGYudGV4dCA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRpZih0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKVxyXG5cdFx0XHRyZXR1cm4gdGV4dDtcclxuXHJcblx0XHRpZih0ZXh0ID09PSB2YWx1ZSkgcmV0dXJuO1xyXG5cclxuXHRcdHRleHQgPSB2YWx1ZTtcclxuXHRcdGNvbnRlbnQudGV4dCh0ZXh0KTtcclxuXHJcblx0XHRpZihpbmxpbmVDb250ZW50KVxyXG5cdFx0XHRpbmxpbmVDb250ZW50Lmh0bWwoY29udmVydCh0ZXh0KSk7XHJcblxyXG5cdFx0c2VsZi50cmlnZ2VyLmNoYW5nZSh7IHRleHQ6IHRleHQgfSk7XHJcblx0fTtcclxuXHJcblx0c2VsZi5pbmxpbmUgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG5cdFx0aWYoIW9wdGlvbnMuaW5saW5lKVxyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblxyXG5cdFx0dmFyIGlzSW5saW5lID0gaW5saW5lQ29udGVudC5pcygnOnZpc2libGUnKTtcclxuXHJcblx0XHRpZih0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKVxyXG5cdFx0XHRyZXR1cm4gaXNJbmxpbmU7XHJcblxyXG5cdFx0aWYoaXNJbmxpbmUgIT0gdmFsdWUpXHJcblx0XHRcdHRvZ2dsZUlubGluZSgpO1xyXG5cdH07XHJcblxyXG5cdC8vIEV2ZW50c1xyXG5cclxuXHRzZWxmLm9uID0ge1xyXG5cdFx0Y2hhbmdlOiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmNoYW5nZSwgY2FsbGJhY2spOyB9LFxyXG5cdFx0aW5saW5lVG9nZ2xlOiBmdW5jdGlvbihjYWxsYmFjaykgeyBzZWxmLmVsZW1lbnQub24oZXZlbnRzLmlubGluZVRvZ2dsZSwgY2FsbGJhY2spOyB9XHJcblx0fTtcclxuXHJcblx0c2VsZi50cmlnZ2VyID0ge1xyXG5cdFx0Y2hhbmdlOiBmdW5jdGlvbihkYXRhKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5jaGFuZ2UsIGRhdGEpKTsgfSxcclxuXHRcdGlubGluZVRvZ2dsZTogZnVuY3Rpb24oKSB7IHNlbGYuZWxlbWVudC50cmlnZ2VyKG5ldyAkLkV2ZW50KGV2ZW50cy5pbmxpbmVUb2dnbGUpKTsgfVxyXG5cdH07XHJcblxyXG5cdC8qIENvbnN0cnVjdG9yICovXHJcblx0dmFyIGhlYWRlciA9IG5ldyBFZGl0b3JIZWFkZXIob3B0aW9ucyk7XHJcblx0dmFyIGNvbnRlbnQgPSBuZXcgRWRpdG9yQ29udGVudChvcHRpb25zKTtcclxuXHR2YXIgZm9vdGVyID0gb3B0aW9ucy5zYXZlID8gbmV3IEVkaXRvckZvb3RlcigpIDogbnVsbDtcclxuXHR2YXIgaW5saW5lQ29udGVudCA9IG9wdGlvbnMuaW5saW5lID8gJCgnPGRpdiBjbGFzcz1cImlubGluZS1jb250ZW50XCI+PC9kaXY+JykgOiBudWxsO1xyXG5cclxuXHQvLyBTdWJzY3JpYmUgdG8gZXZlbnRzXHJcblxyXG5cdGhlYWRlci5vbi5lZGl0KGZ1bmN0aW9uKCkgeyBjb250ZW50LnN0YXRlKGNvbnRlbnQuc3RhdGVzLmVkaXQpOyB9KTtcclxuXHRoZWFkZXIub24ucHJldmlldyhmdW5jdGlvbigpIHsgY29udGVudC5zdGF0ZShjb250ZW50LnN0YXRlcy5wcmV2aWV3KTsgfSk7XHJcblxyXG5cdGNvbnRlbnQub24uY2hhbmdlKGZ1bmN0aW9uKGRhdGEpIHtcclxuXHRcdGlmKG9wdGlvbnMuc2F2ZSkge1xyXG5cdFx0XHRpZihkYXRhLnRleHQgPT09IHRleHQpIGZvb3Rlci5kaXNhYmxlKCk7XHJcblx0XHRcdGVsc2UgZm9vdGVyLmVuYWJsZSgpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0c2VsZi50ZXh0KGRhdGEudGV4dCk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdGlmKG9wdGlvbnMuc2F2ZSkge1xyXG5cdFx0Zm9vdGVyLm9uLnNhdmUoZnVuY3Rpb24oKSB7IHNlbGYudGV4dChjb250ZW50LnRleHQoKSk7IH0pO1xyXG5cdFx0Zm9vdGVyLm9uLnJldmVydChmdW5jdGlvbigpIHsgY29udGVudC50ZXh0KHNlbGYudGV4dCgpKTsgfSk7XHJcblx0fVxyXG5cclxuXHRpZihvcHRpb25zLmlubGluZSkge1xyXG5cdFx0Y29udGVudC5oaWRlKCk7XHJcblxyXG5cdFx0aWYob3B0aW9ucy5zYXZlKVxyXG5cdFx0XHRmb290ZXIuaGlkZSgpO1xyXG5cclxuXHRcdGhlYWRlci5vbi50b2dnbGUodG9nZ2xlSW5saW5lKTtcclxuXHR9XHJcblxyXG5cdC8vIEFkZCBhbGwgdGhlIGVsZW1lbnRzXHJcblx0dmFyIGJvZHkgPSAkKCc8ZGl2IGNsYXNzPVwiY20tZWRpdG9yLWJvZHlcIj48L2Rpdj4nKS5hcHBlbmQoY29udGVudC5lbGVtZW50KTtcclxuXHJcblx0aWYoZm9vdGVyKVxyXG5cdFx0Ym9keS5hcHBlbmQoZm9vdGVyLmVsZW1lbnQpO1xyXG5cclxuXHRpZihpbmxpbmVDb250ZW50KVxyXG5cdFx0Ym9keS5hcHBlbmQoaW5saW5lQ29udGVudCk7XHJcblxyXG5cdHNlbGYuZWxlbWVudC5hZGRDbGFzcygnY29tbW9ubWFyay1lZGl0b3InKVxyXG5cdFx0LmFwcGVuZChoZWFkZXIuZWxlbWVudClcclxuXHRcdC5hcHBlbmQoYm9keSk7XHJcblxyXG5cdHNlbGYudGV4dChvcHRpb25zLnRleHQpO1xyXG59IiwiJC5mbi5jb21tb25NYXJrRWRpdG9yID0gZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cdG9wdGlvbnMgPSAkLmV4dGVuZCh7XHJcblx0XHRoZWFkZXI6IHRydWUsXHJcblx0XHRpbmxpbmU6IGZhbHNlLFxyXG5cdFx0bmFtZTogbnVsbCxcclxuXHRcdHNhdmU6IGZhbHNlLFxyXG5cdFx0dGV4dDogJycsXHJcblx0XHR0aXRsZTogJycsXHJcblx0XHR0b2dnbGU6IHRydWVcclxuXHR9LCBvcHRpb25zKTtcclxuXHJcblx0cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKGluZGV4LCBpdGVtKSB7IHJldHVybiBuZXcgRWRpdG9yKGl0ZW0sIG9wdGlvbnMpOyB9KTtcclxufTsiLCJcdH07XHJcblxyXG5cdGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcclxuXHRcdGRlZmluZShbICdqcXVlcnknLCAnY29tbW9ubWFyaycgXSwgaW5pdCk7XHJcblx0ZWxzZVxyXG5cdFx0aW5pdChqUXVlcnksIGNvbW1vbm1hcmspXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
